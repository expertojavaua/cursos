<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Creaci&oacute;n de clientes para servicios web</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://www.jtech.ua.es/cursos/sws"><img class="logoImage" alt="jtech" src="images/baner_j2ee_izq.gif" title="Especialista Universitario Java Enterprise"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="Servicios Web seguros" src="images/baner_j2ee_der.gif" title="Servicios Web seguros"></a>
</div>
<ul id="tabs">
<li class="current">
<a class="base-selected" href="index.html">Apuntes</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Servicios Web seguros</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Servicios Web seguros">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.2', 'skin/')" id="menu_selected_1.1.2Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Sesiones</div>
<div id="menu_selected_1.1.2" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="sesion01-apuntes.html">Sesi&oacute;n 1</a>
</div>
<div class="menupage">
<div class="menupagetitle">Sesi&oacute;n 2</div>
</div>
<div class="menuitem">
<a href="sesion03-apuntes.html">Sesi&oacute;n 3</a>
</div>
<div class="menuitem">
<a href="sesion04-apuntes.html">Sesi&oacute;n 4</a>
</div>
<div class="menuitem">
<a href="sesion05-apuntes.html">Sesi&oacute;n 5</a>
</div>
<div class="menuitem">
<a href="sesion06-apuntes.html">Sesi&oacute;n 6</a>
</div>
<div class="menuitem">
<a href="sesion07-apuntes.html">Sesi&oacute;n 7</a>
</div>
<div class="menuitem">
<a href="sesion08-apuntes.html">Sesi&oacute;n 8</a>
</div>
<div class="menuitem">
<a href="sesion09-apuntes.html">Sesi&oacute;n 9</a>
</div>
<div class="menuitem">
<a href="sesion10-apuntes.html">Sesi&oacute;n 10</a>
</div>
<div class="menuitem">
<a href="sesion11-apuntes.html">Sesi&oacute;n 11</a>
</div>
<div class="menuitem">
<a href="sesion12-apuntes.html">Sesi&oacute;n 12</a>
</div>
<div class="menuitem">
<a href="roadmap-apuntes.html" title="Roadmap">Roadmap</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion02-apuntes.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Creaci&oacute;n de clientes para servicios web</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Instalaci%C3%B3n+de+Eclipse+y+Maven">Instalaci&oacute;n de Eclipse y Maven</a>
</li>
<li>
<a href="#Cliente+web+e+instalaci%C3%B3n+de+Apache+CXF">Cliente web e instalaci&oacute;n de Apache CXF</a>
<ul class="minitoc">
<li>
<a href="#Instalaci%C3%B3n+y+configuraci%C3%B3n+de+CXF">Instalaci&oacute;n y configuraci&oacute;n de CXF</a>
</li>
<li>
<a href="#Generaci%C3%B3n+del+cliente+CXF+a+partir+del+WSDL">Generaci&oacute;n del cliente CXF a partir del WSDL</a>
</li>
<li>
<a href="#Generaci%C3%B3n+del+cliente+con+Axis2+a+partir+del+WSDL">Generaci&oacute;n del cliente con Axis2 a partir del WSDL</a>
</li>
</ul>
</li>
<li>
<a href="#Montiorizaci%C3%B3n+de+mensajes+SOAP">Montiorizaci&oacute;n de mensajes SOAP</a>
</li>
<li>
<a href="#Ejercicios">Ejercicios</a>
<ul class="minitoc">
<li>
<a href="#Cliente+para+acceder+a+datos+bibliogr%C3%A1ficos">Cliente para acceder a datos bibliogr&aacute;ficos</a>
</li>
</ul>
</li>
</ul>
</div>





<p>La creaci&oacute;n de clientes para servicios web cuenta con diferentes herramientas 
que generan c&oacute;digo a partir del documento WSDL del servicio web. Independientemente 
de la plataforma y lenguaje que gestione el servicio web (java, .net, c++), el 
documento WSDL ser&aacute; el contrato entre cliente y servidor, y si el cliente cumple 
con lo especificado en &eacute;l, el servicio deber&aacute; responder correctamente. 
Las herramientas que generan c&oacute;digo cliente crean el esqueleto donde podremos 
introducir los par&aacute;metros de la llamada al servicio web, seg&uacute;n la especificaci&oacute;n 
del WSDL. Por ejemplo, la herramienta wsimport toma como entrada la URI del WSDL 
por l&iacute;nea de comando:</p>


<pre class="code"> wsimport -s &lt;src.dir&gt; -d &lt;dest.dir&gt; -p &lt;pkg&gt; &lt;wsdl.uri&gt;</pre>



<p>Tambi&eacute;n existe una tarea equivalente de ant. Para poder utilizarla debe 
declararse previamente, teniendo la librer&iacute;a <span class="codefrag">jaxws-tools.jar</span> dentro de la 
variable CLASSPATH de ant:</p>


<pre class="code"> 
&lt;taskdef name="wsimport" 
         classname="com.sun.tools.ws.ant.WsImport" /&gt;
&lt;wsimport sourcedestdir="${src.home}" 
          destdir="${bin.home}" 
          package="${pkg.name}" 
          wsdl="${wsdl.uri}" /&gt;

</pre>




<p>Con esto se generar&aacute;n una serie de clases que nos permiten acceder al servicio
web e invocar sus operaciones desde nuestro cliente. Dentro de estas clases 
tendremos una que recibir&aacute; el mismo nombre que el servicio, y que hereder&aacute; de la 
clase Service. Deberemos instanciarla, y a partir de ella obtendremos el stub para 
acceder a un puerto del servicio. A partir de este stub, que tendr&aacute; la misma 
interfaz que el servicio web, podremos invocar sus operaciones. 
Otra herramienta la ofrece Eclipse a trav&eacute;s del framework Axis de Apache. 
La herramienta Web Services Explorer nos permite probar servicios web de manera 
sencilla. Dicha herramienta viene en la distribuci&oacute;n Eclipse Galileo que incluye 
las herramientas de programaci&oacute;n web de Java Enterprise Edition. Tambi&eacute;n ofrece 
un asistente para crear clientes, aunque &eacute;ste no cuenta con opciones para 
configurar servicios web seguros. Por otro lado el otro IDE de desarrollo 
m&aacute;s utilizado para Java, Netbeans, tambi&eacute;n ofrece asistentes para la generaci&oacute;n 
de c&oacute;digo cliente de servicios web, pero no es para Axis2 ni CXF, sino para Metro, 
que es el framework para servicios web de Sun Microsystems. </p>


<a name="N10022"></a><a name="Instalaci%C3%B3n+de+Eclipse+y+Maven"></a>
<h2 class="underlined_10">Instalaci&oacute;n de Eclipse y Maven</h2>
<div class="section">
<p>En primer lugar debemos descargar el JDK 1.6 de Sun Microsystems. 
Algunas distribuciones de los sistemas operativos incluyen sus propias 
implementaciones de Java pero en estos ejemplos hemos utilizado la versi&oacute;n 
oficial de Sun. Una vez descargada e instalada, conviene indicarle a Eclipse 
que se ejecute con la m&aacute;quina virtual de esta misma distribuci&oacute;n de Java. 
Eclipse est&aacute; implementado en Java y por tanto se ejecuta en una m&aacute;quina virtual, 
cuya versi&oacute;n no tiene por qu&eacute; coincidir con la del JDK que despu&eacute;s se utilice 
para desarrollar los proyectos. Pero si queremos que Eclipse se ejecute en la 
m&aacute;quina virtual que viene en el JDK 1.6, tendremos que editar el archivo 
<span class="codefrag">eclipse/eclipse.ini</span> y antes de la l&iacute;nea <span class="codefrag">"-vmargs"</span> a&ntilde;adirle dos
l&iacute;neas que especifican la ruta de la m&aacute;quina virtual,</p>
<pre class="code">-vm 
/opt/jdk1.6.0_20/bin/java 
</pre>
<p>donde <span class="codefrag">/opt/</span> es la ruta donde hemos descomprimido el JDK, en este caso 
la versi&oacute;n 1.6.0, revisi&oacute;n 20.</p>
<p>Otra cosa diferente es el entorno de ejecuci&oacute;n de Java utilizado por 
Eclipse para los proyectos de Java. La especificaremos en la opci&oacute;n 
Preferences del men&uacute; Window:</p>
<p>
<img alt="Preferences" content-width="10.44cm" src="imagenes/sws/04.png" width="700"></p>
<p>Una vez configurado Eclipse con la versi&oacute;n de Java deseada, 
podemos pasar a descargar los componentes adicionales que vamos a necesitar.
</p>
<p>En este curso nos centraremos en el uso de Axis2 y CXF usando Eclipse y 
el gestor de proyectos Maven de Apache. Recomendamos instalar la distribuci&oacute;n 
Eclipse Galileo, o bien a&ntilde;adir las fuentes del repositorio de Galileo, en el 
men&uacute; Help / Install new software... :
</p>
<p>
<img alt="Galileo" content-width="8.80cm" src="imagenes/sws/01.png" width="700"></p>
<p>En el campo location introducimos la url:
</p>
<pre class="code">http://download.eclipse.org/releases/galileo</pre>
<p>En la distribuci&oacute;n Galileo de Eclipse este repositorio ya estar&aacute; a&ntilde;adido, 
as&iacute; que vamos a pasar a a&ntilde;adir el repositorio de Maven2, que nos facilitar&aacute; 
el trabajo de bajar archivos .jar, teniendo en cuenta todas sus dependencias. 
El sitio a a&ntilde;adir es (otra vez, a trav&eacute;s de la opci&oacute;n Install new software del 
men&uacute; Help, y a continuaci&oacute;n pulsando Add):
</p>
<pre class="code">http://m2eclipse.sonatype.org/sites/m2e</pre>
<p>y el nombre puede ser arbitrario, introduciremos <span class="codefrag">m2eclipse</span>.
</p>
<p>
<img alt="m2eclipse" content-width="8.80cm" src="imagenes/sws/02.png" width="700"></p>
<p>Una vez pulsado OK, seleccionamos el sitio m2eclipse y esperamos a que se 
carguen los repositorios. Los seleccionamos y pulsamos Next:</p>
<p>
<img alt="Install m2eclipse" content-width="8.80cm" src="imagenes/sws/03.png" width="700"></p>
<p>Aceptamos las condiciones y pulsamos finalizar para que empiece la descarga e 
instalaci&oacute;n de los paquetes.</p>
<p>En caso de que la instalaci&oacute;n no pueda continuar obteniendo el 
siguiente error:
</p>
<pre class="code"> 
Cannot complete the install because one or more required items 
could not be found. 
  Software being installed: Maven Integration for Eclipse 
  (Required) 0.10.0.20100209-0800 
  (org.maven.ide.eclipse.feature.feature.group 0.10.0.20100209-0800) 
  Missing requirement: Maven Integration for Eclipse 
  (Editors) 0.10.0.20100209-0800 
  (org.maven.ide.eclipse.editor 0.10.0.20100209-0800) requires 
  'bundle org.eclipse.zest.core 0.0.0' but it could not be found 
  Cannot satisfy dependency: 
    From: Maven Integration for Eclipse (Required) 0.10.0.20100209-0800 
    (org.maven.ide.eclipse.feature.feature.group 0.10.0.20100209-0800) 
    To: org.maven.ide.eclipse.editor [0.10.0.20100209-0800]

</pre>
<p>es posible que se deba a alg&uacute;n problema de red que Eclipse 3.5.1 tiene con 
proxies NTLMv2. Puede ser necesario intentarlo desde otra red o subred. 
Tambi&eacute;n debemos asegurarnos de que los repositorios de Galileo est&eacute;n incluidos, 
tal y como se indica arriba. </p>
<p>Otra cosa que puede ocurrir durante la instalaci&oacute;n es que se nos pregunte 
si nos fiamos de ciertos contenidos que no est&aacute;n firmados. Podemos marcar 
que s&iacute;, para incluirlos y continuar con la instalaci&oacute;n.</p>
<p>Finalmente nos pregunta si deseamos reiniciar eclipse, y contestamos que s&iacute;, 
para terminar con la instalaci&oacute;n. Una vez abierto el workbench, podemos pasar 
a la perspectiva Java EE (default), que normalmente nos encontraremos abierta 
por defecto. Para pasar a esta perspectiva en caso de estar otra, podemos ir al 
men&uacute; Window / Open Perspective / Other / Java EE (default). </p>
</div>


<a name="N1008B"></a><a name="Cliente+web+e+instalaci%C3%B3n+de+Apache+CXF"></a>
<h2 class="underlined_10">Cliente web e instalaci&oacute;n de Apache CXF</h2>
<div class="section">
<p>Una vez instalado Maven2, vamos a utilizarlo para gestionar nuestros 
proyectos de CXF y Axis2. Vamos a empezar creando un cliente a partir de 
un servicio web publicado en un servidor de internet, en concreto, el 
servidor <span class="codefrag">www.jtech.ua.es</span>. El wsdl del servicio se encuentra 
publicado en:</p>
<p> 
<a href="http://www.jtech.ua.es/HolaMundo/wsdl/HolaMundoSW.wsdl">
http://www.jtech.ua.es/HolaMundo/wsdl/HolaMundoSW.wsdl</a> 
</p>
<p>Con el navegador web podemos comprobar que su contenido es el siguiente:</p>
<pre class="code"> 
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;wsdl:definitions 
 targetNamespace="http://sw.hola.servcweb.jtech.ua.es" 
 xmlns:apachesoap="http://xml.apache.org/xml-soap" 
 xmlns:impl="http://sw.hola.servcweb.jtech.ua.es" 
 xmlns:intf="http://sw.hola.servcweb.jtech.ua.es" 
 xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/" 
 xmlns:wsdlsoap="http://schemas.xmlsoap.org/wsdl/soap/" 
 xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
&lt;!--WSDL created by Apache Axis version: 1.3
Built on Oct 05, 2005 (05:23:37 EDT)--&gt;
 &lt;wsdl:types&gt;
  &lt;schema elementFormDefault="qualified" 
   targetNamespace="http://sw.hola.servcweb.jtech.ua.es" 
   xmlns="http://www.w3.org/2001/XMLSchema"&gt;
   &lt;element name="saluda"&gt;
    &lt;complexType&gt;
     &lt;sequence&gt;
      &lt;element name="nombre" type="xsd:string"/&gt;
     &lt;/sequence&gt;
    &lt;/complexType&gt;
   &lt;/element&gt;
   &lt;element name="saludaResponse"&gt;
    &lt;complexType&gt;
     &lt;sequence&gt;
      &lt;element name="saludaReturn" type="xsd:string"/&gt;
     &lt;/sequence&gt;
    &lt;/complexType&gt;
   &lt;/element&gt;
  &lt;/schema&gt;
 &lt;/wsdl:types&gt;
   &lt;wsdl:message name="saludaResponse"&gt;
      &lt;wsdl:part element="impl:saludaResponse" name="parameters"/&gt;
   &lt;/wsdl:message&gt;
   &lt;wsdl:message name="saludaRequest"&gt;
      &lt;wsdl:part element="impl:saluda" name="parameters"/&gt;
   &lt;/wsdl:message&gt;
   &lt;wsdl:portType name="HolaMundoSW"&gt;
      &lt;wsdl:operation name="saluda"&gt;
         &lt;wsdl:input message="impl:saludaRequest" name="saludaRequest"/&gt;
         &lt;wsdl:output message="impl:saludaResponse" name="saludaResponse"/&gt;
      &lt;/wsdl:operation&gt;
   &lt;/wsdl:portType&gt;
   &lt;wsdl:binding name="HolaMundoSWSoapBinding" type="impl:HolaMundoSW"&gt;
      &lt;wsdlsoap:binding style="document" 
       transport="http://schemas.xmlsoap.org/soap/http"/&gt;
      &lt;wsdl:operation name="saluda"&gt;
         &lt;wsdlsoap:operation soapAction=""/&gt;
         &lt;wsdl:input name="saludaRequest"&gt;
            &lt;wsdlsoap:body use="literal"/&gt;
         &lt;/wsdl:input&gt;
         &lt;wsdl:output name="saludaResponse"&gt;
            &lt;wsdlsoap:body use="literal"/&gt;
         &lt;/wsdl:output&gt;
      &lt;/wsdl:operation&gt;
   &lt;/wsdl:binding&gt;
   &lt;wsdl:service name="HolaMundoSWService"&gt;
      &lt;wsdl:port binding="impl:HolaMundoSWSoapBinding" name="HolaMundoSW"&gt;
         &lt;wsdlsoap:address 
          location="http://jtech.ua.es/HolaMundo/services/HolaMundoSW"/&gt;
      &lt;/wsdl:port&gt;
   &lt;/wsdl:service&gt;
&lt;/wsdl:definitions&gt;

</pre>
<p>Vamos a utilizar el navegador para guardar el archivo con el men&uacute; 
Archivo / Guardar como. A continuaci&oacute;n vamos a crear un cliente del 
servicio web especificado en el documento WSDL.
</p>
<a name="N100A8"></a><a name="Instalaci%C3%B3n+y+configuraci%C3%B3n+de+CXF"></a>
<h3 class="underlined_5">Instalaci&oacute;n y configuraci&oacute;n de CXF</h3>
<p>En Eclipse creamos un nuevo proyecto tradicional de java: 
File / New / Other /Java project. Lo llamamos <span class="codefrag">HolaMundoCliente</span>, 
dejamos el resto de opciones por defecto, y finalizamos la creaci&oacute;n. 
Ahora pulsamos con el bot&oacute;n derecho sobre el nombre del proyecto y en 
la opci&oacute;n Maven pulsamos Enable Dependency Management para convertirlo en un 
proyecto gestionado por Maven. Esta operaci&oacute;n puede tardar varios segundos. 
Se generar&aacute; y se abrir&aacute; el archivo <span class="codefrag">pom.xml</span> que est&aacute; en la ra&iacute;z 
del proyecto. El editor del <span class="codefrag">pom.xml</span> incluye una serie de pesta&ntilde;as 
que nos permiten gestionar de manera gr&aacute;fica muchos aspectos del archivo de 
configuraci&oacute;n. Sin embargo muchas veces haremos uso de la &uacute;ltima pesta&ntilde;a que 
es la que nos ofrece la vista plana del c&oacute;digo XML. Vamos a empezar a&ntilde;adiendo 
una dependencia a trav&eacute;s de la pesta&ntilde;a de dependencias:</p>
<p>
<img alt="Dependencias" content-width="6.73cm" src="imagenes/sws/05.png" width="561"></p>
<p>Pulsamos Add y tecleamos <span class="codefrag">cxf-bundle</span> en el campo que filtra los resultados. 
Seleccionamos la versi&oacute;n 2.2.5 de cxf-bundle y pulsamos Ok.</p>
<p>
<img alt="Dependencia cxf-bundle" content-width="6.36cm" src="imagenes/sws/06.png" width="530"></p>
<p>De la misma manera a&ntilde;adimos la dependencia con la librer&iacute;a xercesImpl, 
la versi&oacute;n 2.9.1, quedando la pesta&ntilde;a de dependencias as&iacute;:</p>
<p>
<img alt="xercesImpl" content-width="6.71cm" src="imagenes/sws/07.png" width="559"></p>
<p>Si ahora guardamos el archivo pom.xml, empezar&aacute;n a descargarse las dependencias. 
Antes de hacerlo, 
vamos a editar el archivo en modo XML para introducir algunas modificaciones m&aacute;s.</p>
<p>
<img alt="pom.xml" content-width="6.73cm" src="imagenes/sws/08.png" width="563"></p>
<p>Vamos a eliminar las l&iacute;neas que indican el 
<span class="codefrag">&lt;type&gt;</span> y <span class="codefrag">&lt;scope&gt;</span> de ambas dependencias. 
Tambi&eacute;n vamos a introducir un repositorio adicional que har&aacute; falta para 
descargar algunas dependnecias del proyecto. Justo antes de la etiqueta de cierre 
<span class="codefrag">&lt;/project&gt;</span> introducimos:</p>
<pre class="code"> 
  &lt;repositories&gt;
  	&lt;repository&gt;
  		&lt;id&gt;apache-incubating&lt;/id&gt;
  		&lt;name&gt;Apache Incubating Repository&lt;/name&gt;
  		&lt;url&gt;http://people.apache.org/repo/m2-incubating-repository&lt;/url&gt;
  	&lt;/repository&gt;
  &lt;/repositories&gt;

</pre>
<p>Adem&aacute;s vamos a a&ntilde;adir un plugin para la correcta compilaci&oacute;n del proyecto, 
una vez generado el c&oacute;digo del cliente. Podemos hacerlo a trav&eacute;s de la pesta&ntilde;a 
Plugins del pom.xml, pulsando el bot&oacute;n Add de la lista de Plugins. 
Tecleamos <span class="codefrag">maven-compiler-plugin</span>, lo seleccionamos y pulsamos Ok. 
Volviendo al modo de edici&oacute;n de XML nos encontramos con esta nueva secci&oacute;n:
</p>
<pre class="code"> 
  &lt;build&gt;
  	&lt;plugins&gt;
  		&lt;plugin&gt;
  			&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
  			&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
  			&lt;version&gt;2.3&lt;/version&gt;
  		&lt;/plugin&gt;
  	&lt;/plugins&gt;
  &lt;/build&gt;

</pre>
<p>La modificamos eliminando la versi&oacute;n y a&ntilde;adiendo unas l&iacute;neas de 
configuraci&oacute;n que indican la versi&oacute;n del JDK:
</p>
<pre class="code"> 
  &lt;build&gt;
  	&lt;plugins&gt;
  		&lt;plugin&gt;
  			&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
  			&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
  			&lt;configuration&gt;
  				&lt;source&gt;1.6&lt;/source&gt;
  				&lt;target&gt;1.6&lt;/target&gt;
  			&lt;/configuration&gt;
  		&lt;/plugin&gt;
  	&lt;/plugins&gt;
  &lt;/build&gt;

</pre>
<p>Finalmente el pom.xml queda as&iacute;:</p>
<pre class="code"> 
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" 
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
                             http://maven.apache.org/maven-v4_0_0.xsd"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;HolaMundoClient&lt;/groupId&gt;
  &lt;artifactId&gt;HolaMundoClient&lt;/artifactId&gt;
  &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
  &lt;dependencies&gt;
  	&lt;dependency&gt;
  		&lt;groupId&gt;org.apache.cxf&lt;/groupId&gt;
  		&lt;artifactId&gt;cxf-bundle&lt;/artifactId&gt;
  		&lt;version&gt;2.2.5&lt;/version&gt;
  	&lt;/dependency&gt;
	&lt;dependency&gt;
		&lt;groupId&gt;xerces&lt;/groupId&gt;
		&lt;artifactId&gt;xercesImpl&lt;/artifactId&gt;
		&lt;version&gt;2.9.1&lt;/version&gt;
	&lt;/dependency&gt;
  &lt;/dependencies&gt;
  &lt;build&gt;
  	&lt;plugins&gt;
  		&lt;plugin&gt;
  			&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
  			&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
  			&lt;configuration&gt;
  				&lt;source&gt;1.6&lt;/source&gt;
  				&lt;target&gt;1.6&lt;/target&gt;
  			&lt;/configuration&gt;
  		&lt;/plugin&gt;
  	&lt;/plugins&gt;
  &lt;/build&gt;
  &lt;repositories&gt;
  	&lt;repository&gt;
  		&lt;id&gt;apache-incubating&lt;/id&gt;
  		&lt;name&gt;Apache Incubating Repository&lt;/name&gt;
  		&lt;url&gt;http://people.apache.org/repo/m2-incubating-repository&lt;/url&gt;
  	&lt;/repository&gt;
  &lt;/repositories&gt;
&lt;/project&gt;

</pre>
<p>Ahora guardamos el el archivo y esperamos unos minutos hasta 
que se descarguen las dependencias. El indicador de progreso aparece abajo 
a la derecha, y puede ser un proceso lento, incluso con una conexi&oacute;n r&aacute;pida. 
Una vez terminado, el proyecto no deber&iacute;a dar ning&uacute;n error. Si hay alg&uacute;n 
problema de red y no se descargan las dependencias, el pom.xml aparecer&aacute; 
marcado con un error. Una construcci&oacute;n (build) correcta dejar&iacute;a el siguiente 
resultado en la salida de la consola:
</p>
<pre class="code"> 
[...]
11/05/10 10:32:43 CEST: Downloaded 
 http://repo1.maven.org/maven2/xalan/xalan/2.7.1/xalan-2.7.1.jar
11/05/10 10:32:44 CEST: Downloading 
 http://repo1.maven.org/maven2/org/bouncycastle/bcprov-jdk15/1.43/
                                             bcprov-jdk15-1.43.jar
11/05/10 10:32:44 CEST: Downloaded 
 http://repo1.maven.org/maven2/org/bouncycastle/bcprov-jdk15/1.43/
                                             bcprov-jdk15-1.43.jar
11/05/10 10:30:59 CEST: Downloaded 
 http://repo1.maven.org/maven2/commons-codec/commons-codec/1.3/
                                             commons-codec-1.3.pom
11/05/10 10:32:46 CEST: Maven Builder: AUTO_BUILD 

</pre>
<p>El proyecto ya tiene las dependencias que vamos a necesitar. 
Vamos a crear dos carpetas de fuentes para colocar los archivos java y 
los recursos adicionales en ellos. Pinchando sobre el proyecto, New / Folder, 
creamos la carpeta
</p>
<pre class="code">src/main/java</pre>
<p>y la carpeta</p>
<pre class="code">src/main/resources</pre>
<p>Ahora pulsamos sobre el proyecto la opci&oacute;n Maven / Update project configuration, 
para que Maven reconozca estas carpetas como carpetas de fuentes. 
Los archivos de <span class="codefrag">src/main/java</span> ser&aacute;n compilados autom&aacute;ticamente por Maven. 
Los de <span class="codefrag">src/main/resources</span> no ser&aacute;n compilados pero se incluir&aacute;n cuando 
se genere un paquete del proyecto. Tras pulsar Update project configuration, 
la vista de Packages queda as&iacute;:
</p>
<p>
<img alt="Packages" content-width="3.07cm" src="imagenes/sws/09.png" width="256"></p>
<a name="N10130"></a><a name="Generaci%C3%B3n+del+cliente+CXF+a+partir+del+WSDL"></a>
<h3 class="underlined_5">Generaci&oacute;n del cliente CXF a partir del WSDL</h3>
<p>Una vez configurado el proyecto para usarlo con Maven y CXF, 
vamos a copiar el documento <span class="codefrag">HolaMundoSW.wsdl</span> que hab&iacute;amos descargado, 
dentro de la carpeta <span class="codefrag">src/main/resources</span> (en Eclipse se puede hacer 
arrastrando desde una carpeta del sistema operativo y solt&aacute;ndolo en 
la carpeta correspondiente de la vista Package).
</p>
<div class="frame note">
<div class="label">Nota</div>
<div class="content">Nota: si lo copiamos a trav&eacute;s del sistema de archivos a la 
carpeta <span class="codefrag">~/workspace/HolaMundoCliente/src/main/resources</span>, 
Eclipse no lo reconocer&aacute; hasta que no pulsemos la opici&oacute;n Refresh 
sobre el proyecto HolaMundoCliente, o bien pulsando F5. 
</div>
</div>
<p>Ahora podemos crear una clase con un m&eacute;todo main desde donde 
ejecutaremos la generaci&oacute;n de c&oacute;digo cliente de CXF. 
Sobre la carpeta <span class="codefrag">src/main/java</span> pulsamos New / Class. 
En el asistente indicamos que el Package debe ser 
</p>
<pre class="code">es.ua.jtech.servcweb.hola.generador</pre>
<p>y el nombre de la clase,</p>
<pre class="code">GeneraCodigo</pre>
<p>Marcamos la casilla <span class="codefrag">public static void main(String [] args)</span>
y pulsamos Finish.
Dentro del m&eacute;todo main generado, tecleamos <span class="codefrag">WSDLToJava</span> y pulsamos 
Ctrl - espacio para que nos permita seleccionar el import correspondiente. 
Pulsamos enter para que se a&ntilde;ada el import
</p>
<pre class="code">import org.apache.cxf.tools.wsdlto.WSDLToJava;</pre>
<p>Introducimos una llamada al m&eacute;todo <span class="codefrag">WSDLToJava.main</span> pas&aacute;ndole 
un array de Strings que es el conjunto de argumentos (este m&eacute;todo podr&iacute;a 
haberse invocado por l&iacute;nea de comandos, pero lo vamos a hacer desde Java). 
Los argumentos indicar&aacute;n que queremos generar el cliente, que el directorio 
de destino es el src/main/java, y la ruta del documento wsdl. 
El archivo <span class="codefrag">GeneraCodigo.java</span> queda finalmente as&iacute;:
</p>
<pre class="code"> 
package es.ua.jtech.servcweb.hola.generador;

import org.apache.cxf.tools.wsdlto.WSDLToJava;

public class GeneraCodigo {
	public static void main(String[] args) {
		WSDLToJava.main(new String[]{
				"-client",
				"-d","src/main/java",
				"src/main/resources/HolaMundoSW.wsdl"
			});
		System.out.println("Hecho, no olvide hacer Refresh.");
	}
}

</pre>
<p>Lo ejecutamos (bot&oacute;n derecho, Run as / Java application) y vemos el 
mensaje del println en la consola. Entonces podemos pulsar Refresh 
para comprobar que se ha generado el c&oacute;digo:</p>
<p>
<img alt="Paquete generado" content-width="3.05cm" src="imagenes/sws/10.png" width="254"></p>
<p>Ahora podemos editar el <span class="codefrag">HolaMundoSW_HolaMundoSW_Client.java</span>: 
nos encontramos con que el nombre y direcci&oacute;n del servicio han sido extra&iacute;dos 
del wsdl:
</p>
<pre class="code">
private static final QName SERVICE_NAME = 
	new QName("http://sw.hola.servcweb.jtech.ua.es", "HolaMundoSWService");
</pre>
<p>y est&aacute;n correctos. Ahora debemos modificar la llamada para introducir 
un valor al par&aacute;metro:
</p>
<pre class="code">
        System.out.println("Invoking saluda...");
        java.lang.String _saluda_nombre = "Boyan";
        java.lang.String _saluda__return = port.saluda(_saluda_nombre);
        System.out.println("saluda.result=" + _saluda__return);

</pre>
<p>Podemos guardar y ejecutarlo como aplicaci&oacute;n java. 
Se conectar&aacute; al servidor de JTech y acceder&aacute; al servicio web, 
pas&aacute;ndole el par&aacute;metro "Boyan" a la llamada "saluda", seg&uacute;n lo especificado 
en el documento wsdl. Despu&eacute;s recoger&aacute; el resultado y mostrar&aacute; en la salida 
de la consola:
</p>
<pre class="code">
Invoking saluda...
saluda.result=Hola Boyan
</pre>
<a name="N10193"></a><a name="Generaci%C3%B3n+del+cliente+con+Axis2+a+partir+del+WSDL"></a>
<h3 class="underlined_5">Generaci&oacute;n del cliente con Axis2 a partir del WSDL</h3>
<p>Vamos a reutilizar el proyecto que hemos creado para CXF, eliminando las 
dependencias innecesarias y a&ntilde;adiendo las nuevas. Con el bot&oacute;n derecho 
copiamos el proyecto HolaMundoCliente y lo pegamos; nos preguntar&aacute; por un 
nuevo nombre y lo llamaremos Axis2HolaMundoCliente. Eliminamos el paquete 
<span class="codefrag">es.ua.jtech.servcweb.hola.sw</span> junto con todas las clases que &eacute;ste contiene, 
ya que vamos a volver a generar el c&oacute;digo. Tambi&eacute;n podemos eliminar la 
llamada <span class="codefrag">WSDLToJava.main</span> del main de <span class="codefrag">GeneraCodigo.java</span>, 
ya que la sustituiremos por otra diferente (tambi&eacute;n deber&iacute;amos eliminar su 
import, que queda en desuso). Ahora editamos el pom.xml para quitar las 
dependencias de CXF y poner las de Axis2 que necesitemos para la construcci&oacute;n 
del cliente. En la pesta&ntilde;a Dependencies eliminamos la dependencia a cxf-bundle 
y a&ntilde;adimos cuatro nuevas: axis2-codegen, axis2-adb-codegen, axis2-transport-http 
y axis2-transport-local, todas ellas pertenecientes a org.apache.axis2 y 
todas en sus versiones 1.5.1. Editamos en modo XML y borramos de ambas las 
l&iacute;neas que especifican el <span class="codefrag">&lt;type&gt;</span> y el <span class="codefrag">&lt;scope&gt;</span>. 
Tambi&eacute;n eliminamos el repositorio adicional que hab&iacute;amos a&ntilde;adido para CXF, 
el Apache Incubating, que ya no va a hacer falta. Guardamos el <span class="codefrag">pom.xml</span> para 
que se actualicen las dependencias. Debe haber quedado as&iacute;:
</p>
<pre class="code"> 
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" 
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
                      http://maven.apache.org/maven-v4_0_0.xsd"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;HolaMundoCliente&lt;/groupId&gt;
  &lt;artifactId&gt;HolaMundoCliente&lt;/artifactId&gt;
  &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
  &lt;build&gt;
  	&lt;plugins&gt;
  		&lt;plugin&gt;
  			&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
  			&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
  			&lt;configuration&gt;
  				&lt;source&gt;1.6&lt;/source&gt;
  				&lt;target&gt;1.6&lt;/target&gt;
  			&lt;/configuration&gt;
  		&lt;/plugin&gt;
  	&lt;/plugins&gt;
  &lt;/build&gt;
  &lt;dependencies&gt;
  	&lt;dependency&gt;
  		&lt;groupId&gt;xerces&lt;/groupId&gt;
  		&lt;artifactId&gt;xercesImpl&lt;/artifactId&gt;
  		&lt;version&gt;2.9.1&lt;/version&gt;
  	&lt;/dependency&gt;
  	&lt;dependency&gt;
  		&lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;
  		&lt;artifactId&gt;axis2-codegen&lt;/artifactId&gt;
  		&lt;version&gt;1.5.1&lt;/version&gt;
  	&lt;/dependency&gt;
  	&lt;dependency&gt;
  		&lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;
  		&lt;artifactId&gt;axis2-adb-codegen&lt;/artifactId&gt;
  		&lt;version&gt;1.5.1&lt;/version&gt;
  	&lt;/dependency&gt;
  	&lt;dependency&gt;
  		&lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;
  		&lt;artifactId&gt;axis2-transport-http&lt;/artifactId&gt;
  		&lt;version&gt;1.5.1&lt;/version&gt;
  	&lt;/dependency&gt;
  	&lt;dependency&gt;
  		&lt;groupId&gt;org.apache.axis2&lt;/groupId&gt;
  		&lt;artifactId&gt;axis2-transport-local&lt;/artifactId&gt;
  		&lt;version&gt;1.5.1&lt;/version&gt;
  	&lt;/dependency&gt;
  &lt;/dependencies&gt;
&lt;/project&gt;

</pre>
<p>Comprobamos que no se ha generado ning&uacute;n error en el proyecto ni en el 
<span class="codefrag">pom.xml</span> y continuamos, editando de nuevo el <span class="codefrag">GeneraCodigo.java</span>. 
Le a&ntilde;adimos una llamada a <span class="codefrag">org.apache.axis2.wsdl.WSDL2Code.main( )</span>, 
pas&aacute;ndole como argumentos un array de Strings en el que especificamos, 
una vez m&aacute;s, el directorio de destino de las fuentes generadas y la 
ruta (uri) del archivo WSDL. El c&oacute;digo queda as&iacute;:</p>
<pre class="code"> 
package es.ua.jtech.servcweb.hola.generador;

import org.apache.axis2.wsdl.WSDL2Code;

public class GeneraCodigo {
	public static void main(String[] args) throws Exception {
		WSDL2Code.main(new String[]{
				"-S","src/main/java",
				"-uri","src/main/resources/HolaMundoSW.wsdl"
			});
		System.out.println("Generado, no olvide hacer Refresh.");
	}
}

</pre>
<p>Lo ejecutamos como aplicaci&oacute;n java y refrescamos el proyecto de Eclipse. 
En el paquete <span class="codefrag">es.ua.jtech.servcweb.hola.sw</span> se habr&aacute;n generado 
los ficheros <span class="codefrag">HolaMundoSWServiceCallbackHandler.java</span> y 
<span class="codefrag">HolaMundoSWServiceStub.java</span>. &Eacute;ste &uacute;ltimo es es el que vamos a 
utilizar para invocar el servicio. Debemos crear una clase con un m&eacute;todo main 
para realizar la llamada. La crearemos en el nuevo paquete 
<span class="codefrag">es.ua.jtech.servcweb.hola.llamada</span>, y la llamaremos 
<span class="codefrag">HolaMundoCliente</span>:
</p>
<pre class="code"> 
package es.ua.jtech.servcweb.hola.llamada;

import java.rmi.RemoteException;

import es.ua.jtech.servcweb.hola.sw.HolaMundoSWServiceStub;
import es.ua.jtech.servcweb.hola.sw.HolaMundoSWServiceStub.Saluda;
import es.ua.jtech.servcweb.hola.sw.HolaMundoSWServiceStub.SaludaResponse;

public class HolaMundoCliente {
	public static void main(String[] args) throws RemoteException{
		HolaMundoSWServiceStub servicio = new HolaMundoSWServiceStub(
				"http://jtech.ua.es/HolaMundo/services/HolaMundoSW");
		Saluda entrada = new Saluda();
		entrada.setNombre("Boyan");
		SaludaResponse respuesta = servicio.saluda(entrada);
		System.out.println(respuesta.getSaludaReturn());
		
	}
}

</pre>
<p>En la creaci&oacute;n del stub especificamos la URL del servicio web 
(&eacute;sta viene especificada en el WSDL, la podemos encontrar en la etiqueta 
&lt;wsdlsoap:location&gt;). Axis2 nos genera una clase <span class="codefrag">Saluda</span> 
y una clase <span class="codefrag">SaludaResponse</span> (est&aacute;n localizadas dentro de la 
clase del stub) que almacenan los par&aacute;metros de entrada y de salida del servicio. 
Por eso debemos crear un objeto <span class="codefrag">Saluda</span> de entrada, al cu&aacute;l le asignamos 
un valor para el nombre. Pasamos esta entrada como par&aacute;metro al m&eacute;todo 
saluda del stub y obtenemos un <span class="codefrag">SaludaResponse</span> del cu&aacute;l podemos obtener el 
valor de retorno, e imprimirlo por pantalla.</p>
<p>Ejecutamos como aplicaci&oacute;n java la clase <span class="codefrag">HolaMundoCliente</span>, 
que conecta con el servicio web del servidor JTech, recibe la respuesta, 
y nuestro cliente la muestra por la salida est&aacute;ndar (consola):</p>
<pre class="code">
Hola Boyan
</pre>
</div> 


<a name="N101F5"></a><a name="Montiorizaci%C3%B3n+de+mensajes+SOAP"></a>
<h2 class="underlined_10">Montiorizaci&oacute;n de mensajes SOAP</h2>
<div class="section">
<p>Para ver los mensajes SOAP que env&iacute;a y recibe el cliente al servidor, 
podemos utilizar un programa Java distribuido por Apache, el TCP Monitor. 
&Eacute;ste se coloca entre el cliente y el servicio web, e intercepta los mensajes, 
los visualiza, y los reenv&iacute;a. La manera de interceptarlos es configur&aacute;ndolo 
para que escuche determinado puerto (que no est&eacute; actualmente ocupado), y 
configurando que el cliente env&iacute;e sus peticiones a dicho puerto. A su vez el 
TCP Monitor se configura para que reenv&iacute;e los mensajes a otro puerto. 
</p>
<p>El TCP Monitor se puede descargar de la direcci&oacute;n 
<a href="http://ws.apache.org/commons/tcpmon/">http://ws.apache.org/commons/tcpmon/</a>.
Descargamos la Source binary distribution que viene en un ZIP y la 
descomprimimos donde queramos tener la aplicaci&oacute;n. Ejecutamos 
<span class="codefrag">tcpmon.bat</span> o <span class="codefrag">tcpmon.sh</span> seg&uacute;n si estamos en 
Windows o Linux/Mac. Al <span class="codefrag">tcpmon.sh</span> puede hacer falta darle permisos 
para poder ejecutarlo: </p>
<pre class="code">
chmod a+x tcpmon-1.0-bin/build/tcpmon.sh
./tcpmon-1.0-bin/build/tcpmon.sh
</pre>
<p>Una vez ejecutado, abrimos la pesta&ntilde;a Admin donde configuramos nuestra 
nueva conexi&oacute;n. Lo configuramos para que escuche al puerto <span class="codefrag">1234</span>, 
que normalmente est&aacute; desocupado. En Target Hostname introducimos 
<span class="codefrag">jtech.ua.es</span>, y el puerto <span class="codefrag">80</span>, para que reenv&iacute;e 
nuestras peticiones a ese servidor y en ese puerto.</p>
<p>
<img alt="TCPMon: Crear nuevo monitor" content-width="7.36cm" src="imagenes/sws/11.png" width="612"></p>
<p>Pulsamos Add y nos aparece una nueva pesta&ntilde;a con el n&uacute;mero de puerto. 
La abrimos y marcamos la casilla XML Format que aparece en la esquina 
inferior izquierda.
</p>
<p>
<img alt="TCPMon: Monitor en el puerto 1234" content-width="7.36cm" src="imagenes/sws/12.png" width="612"></p>
<p>Ahora el TCP Monitor est&aacute; escuchando en localhost (127.0.0.1), en el puerto 1234, 
esperando a recibir un mensaje por TCP. Vamos a configurar el cliente 
<span class="codefrag">Axis2HolaMundoCliente</span> para que env&iacute;e su mensaje a esa direcci&oacute;n. 
Abrimos <span class="codefrag">HolaMundoCliente.java</span> y modificamos la l&iacute;nea donde se crea el 
<span class="codefrag">HolaMundoSWServiceStub</span>:</p>
<pre class="code">
		HolaMundoSWServiceStub servicio = new HolaMundoSWServiceStub(
				"http://localhost:1234/HolaMundo/services/HolaMundoSW");
</pre>
<p>Ejecutamos el cliente y obtenemos la misma salida que cuando acced&iacute;amos 
directamente a JTech. Volvemos a la ventana del TCP Monitor y observamos:</p>
<p>
<img alt="Mensajes SOAP de petici&oacute;n y de respuesta." content-width="7.36cm" src="imagenes/sws/13.png" width="612"></p>
<p>En la tabla se muestra informaci&oacute;n sobre la comunicaci&oacute;n establecida, 
y en los dos campos de texto de abajo aparece el contenido del mensaje 
enviado y del mensaje recibido desde el servidor, respectivamente. El monitor 
ha interceptado el mensaje de respuesta, lo ha mostrado, y lo ha reenviado al 
cliente para que recibiera su respuesta como si se comunicara directamente con 
el servidor. Si examinamos el mensaje enviado, su contenido es:
</p>
<pre class="code"> 
POST /HolaMundo/services/HolaMundoSW HTTP/1.1 
Content-Type: text/xml; charset=UTF-8 
SOAPAction: "http://sw.hola.servcweb.jtech.ua.es/HolaMundoSW/saludaRequest" 
User-Agent: Axis2 
Host: jtech.ua.es:1234 
Transfer-Encoding: chunked 

109 
&lt;?xml version='1.0' encoding='UTF-8'?&gt;
   &lt;soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"&gt;
      &lt;soapenv:Body&gt;
         &lt;ns1:saluda xmlns:ns1="http://sw.hola.servcweb.jtech.ua.es"&gt;
            &lt;ns1:nombre&gt;Boyan&lt;/ns1:nombre&gt;
         &lt;/ns1:saluda&gt;
      &lt;/soapenv:Body&gt;
   &lt;/soapenv:Envelope&gt;
0

</pre>
<p>Las primeras l&iacute;neas pertenecen a cabeceras TCP. Es interesante observar que 
el User-Agent no es un navegador web, como estamos acostumbrados a ver, 
sino que es nuestro cliente, y por defecto es Axis2, que viene dado por las 
librer&iacute;as que nos han generado el c&oacute;digo del cliente. Lo que nos interesa no 
son las cabeceras TCP sino el mensaje SOAP. &Eacute;ste va envuelto en una etiqueta 
Envelope definida por el est&aacute;ndar 
<a href="http://schemas.xmlsoap.org/soap/envelope/">http://schemas.xmlsoap.org/soap/envelope/</a>. 
La etiqueta <span class="codefrag">Body</span> est&aacute; definida por el mismo est&aacute;ndar. El 
<span class="codefrag">Body</span> es necesario porque el mensaje SOAP tambi&eacute;n puede tener cabecera. 
Dentro del cuerpo del mensaje se define la llamada a saluda, con el campo nombre, 
ambas definidas por 
<a href="http://sw.hola.servcweb.jtech.ua.es">http://sw.hola.servcweb.jtech.ua.es</a>. 
La etiqueta nombre encierra el valor de la cadena que hemos introducido en el 
cliente.
</p>
<p>Si examinamos el mensaje devuelto por el servidor, en el campo de texto 
inferior del TCP Monitor, vemos:</p>
<pre class="code"> 
HTTP/1.1 200 OK 
Content-Type: text/xml;charset=utf-8 
Transfer-Encoding: chunked 
Date: Tue, 11 May 2010 16:56:14 GMT 
Server: Apache-Coyote/1.1 

179 
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" 
                     xmlns:xsd="http://www.w3.org/2001/XMLSchema" 
                     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;
      &lt;soapenv:Body&gt;
         &lt;saludaResponse xmlns="http://sw.hola.servcweb.jtech.ua.es"&gt;
            &lt;saludaReturn&gt;Hola Boyan&lt;/saludaReturn&gt;
         &lt;/saludaResponse&gt;
      &lt;/soapenv:Body&gt;
   &lt;/soapenv:Envelope&gt;
0

</pre>
<p>Las cabeceras TCP nos indican qu&eacute; tipo de servidor nos ha devuelto la respuesta. 
La respuesta SOAP tamb&iacute;en va envuelta en un Envelope y un Body, y 
las etiquetas saludaResponse y saludaReturn van especificadas, una vez m&aacute;s, en 
<a href="http://sw.hola.servcweb.jtech.ua.es">http://sw.hola.servcweb.jtech.ua.es</a>. 
La etiqueta saludaReturn encierra el valor de la cadena devuelta.
</p>
<p>Si queremos hacer lo mismo con el cliente que generamos con CXF, 
debemos acceder al contexto de la conexi&oacute;n para modificar la propiedad 
<span class="codefrag">ENDPOINT_ADDRESS_PROPERTY</span>. Es un poco m&aacute;s complicado debido a que 
CXF ya nos introdujo la direcci&oacute;n del Endpoint seg&uacute;n la especificaci&oacute;n del 
WSDL. Para hacerlo, introducimos en el fichero 
<span class="codefrag">HolaMundoSW_HolaMundoSW_Client.java</span>, despu&eacute;s de la l&iacute;nea
</p>
<pre class="code">HolaMundoSW port = ss.getHolaMundoSW();</pre>
<p>las siguientes l&iacute;neas:</p>
<pre class="code"> 
        BindingProvider bp = (BindingProvider) port;
        Map&lt;String, Object&gt; properties = bp.getRequestContext();
        properties.put(BindingProvider.ENDPOINT_ADDRESS_PROPERTY, 
        		"http://localhost:1234/HolaMundo/services/HolaMundoSW");

</pre>
<p>La l&iacute;nea siguiente ya es la de 
<span class="codefrag">System.out.println("Invoking saluda...")</span>. Ahora podemos ejecutar 
este cliente y observar que el mensaje SOAP generado es, en este caso, muy parecido:
</p>
<pre class="code"> 
POST /HolaMundo/services/HolaMundoSW HTTP/1.1 
Content-Type: text/xml; charset=UTF-8 
SOAPAction: "" 
Accept: */* 
User-Agent: Apache CXF 2.2.5 
Cache-Control: no-cache 
Pragma: no-cache 
Host: jtech.ua.es:1234 
Connection: keep-alive 
Content-Length: 192 

&lt;soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"&gt;
   &lt;soap:Body&gt;
      &lt;saluda xmlns="http://sw.hola.servcweb.jtech.ua.es"&gt;
         &lt;nombre&gt;Boyan&lt;/nombre&gt;
      &lt;/saluda&gt;
   &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;

</pre>
<p>El User-Agent es, esta vez, Apache CXF 2.2.5 . </p>
<p>El TCP Monitor es una herramienta que utilizaremos para comprobar 
si nuestros mensajes SOAP realmente contienen toda la informaci&oacute;n que 
queremos enviar, y si &eacute;sta va cifrada o si contiene alguna firma digital.
</p>
</div> 


<p class="pageBreakAfter"></p>



<a name="N10299"></a><a name="Ejercicios"></a>
<h2 class="underlined_10">Ejercicios</h2>
<div class="section">
<a name="N1029F"></a><a name="Cliente+para+acceder+a+datos+bibliogr%C3%A1ficos"></a>
<h3 class="underlined_5">Cliente para acceder a datos bibliogr&aacute;ficos</h3>
<p>Una biblioteca ficticia nos ofrece el servicio de buscar libros por ISBN.
Todo lo que nos ofrecen es el WSDL del servicio en su endpoint correspondiente:
</p>
<p>
<a href="http://server.jtech.ua.es/servcweb-catalogo-jtech/CatalogoSWService?wsdl">http://server.jtech.ua.es/servcweb-catalogo-jtech/CatalogoSWService?wsdl</a>
</p>
<p>Se pide implementar un cliente con CXF que acceda a dicho servicio.</p>
<ol>

<li>&iquest;Qu&eacute; campos del libro nos devuelve el servicio?</li>

<li>Si los campos no aparecen directamente en el WSDL arriba indicado, 
&iquest;de d&oacute;nde los ha obtenido nuestro generador de c&oacute;digo?</li>

<li>Obtener la informaci&oacute;n de los libros con ISBN:
  <ul>
  	
<li>0131401572</li>
  	
<li>0321180860</li>
  	
<li>0471768944</li>
  	
<li>0764558315</li>
  	
<li>097451408X</li>
  	
<li>097451408X</li>
  	
<li>0977616649</li>
  	
<li>1590595874</li>
  	
<li>1932394885</li>
  	
<li>1933988347</li>
  
</ul>

</li>

</ol>
</div>




<p class="pageBreakAfter"></p>

</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2010 Depto. CCIA</div>
</div>
</body>
</html>
