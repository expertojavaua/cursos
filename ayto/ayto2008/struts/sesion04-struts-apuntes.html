<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Internacionalizaci&oacute;n. Pruebas</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://www.jtech.ua.es/j2ee"><img class="logoImage" alt="jtech" src="images/baner_j2ee_izq.gif" title="Especialista Universitario Java Enterprise"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="Proyecto de Integracion" src="images/baner_j2ee_der.gif" title="Proyecto de Integracion"></a>
</div>
<ul id="tabs">
<li>
<a class="external" href="javascript:location.href='../index.html'">Home</a>
</li>
<li>
<a class="external" href="javascript:location.href='../aplic-web.html'">Aplicaciones Web</a>
</li>
<li>
<a class="external" href="javascript:location.href='../aplic-ent.html'">Aplicaciones Enterprise</a>
</li>
<li>
<a class="external" href="javascript:location.href='../charlas.html'">Charlas</a>
</li>
<li>
<a class="external" href="javascript:location.href='../proy-int/index.html'">Proyecto</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Struts</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Struts</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Struts">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.2', 'skin/')" id="menu_selected_1.1.2Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Teor&iacute;a</div>
<div id="menu_selected_1.1.2" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="sesion01-struts-apuntes.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-struts-apuntes.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-struts-apuntes.html">Sesion 3</a>
</div>
<div class="menupage">
<div class="menupagetitle">Sesion 4</div>
</div>
<div class="menuitem">
<a href="roadmap-struts.html">Roadmap Struts</a>
</div>
</div>
<div onclick="SwitchMenu('menu_1.1.3', 'skin/')" id="menu_1.1.3Title" class="menutitle">Ejercicios</div>
<div id="menu_1.1.3" class="menuitemgroup">
<div class="menuitem">
<a href="sesion01-struts-ejercicios.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-struts-ejercicios.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-struts-ejercicios.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-struts-ejercicios.html">Sesion 4</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion04-struts-apuntes.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Internacionalizaci&oacute;n. Pruebas</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Internacionalizaci%C3%B3n">Internacionalizaci&oacute;n</a>
<ul class="minitoc">
<li>
<a href="#El+soporte+de+internacionalizaci%C3%B3n+de+Java">El soporte de internacionalizaci&oacute;n de Java</a>
<ul class="minitoc">
<li>
<a href="#Locale">Locale</a>
</li>
<li>
<a href="#ResourceBundle">ResourceBundle</a>
</li>
<li>
<a href="#MessageFormat">MessageFormat</a>
</li>
</ul>
</li>
<li>
<a href="#El+soporte+de+internacionalizaci%C3%B3n+de+Struts">El soporte de internacionalizaci&oacute;n de Struts</a>
<ul class="minitoc">
<li>
<a href="#Cambiar+el+locale+actual">Cambiar el locale actual</a>
</li>
<li>
<a href="#MessageResources%3A+el+ResourceBundle+de+Struts">MessageResources: el ResourceBundle de Struts</a>
</li>
<li>
<a href="#Componentes+de+Struts+%22sensibles%22+al+locale">Componentes de Struts "sensibles" al locale</a>
</li>
<li>
<a href="#Localizaci%C3%B3n+de+%22validator%22">Localizaci&oacute;n de "validator"</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#Pruebas">Pruebas</a>
<ul class="minitoc">
<li>
<a href="#Una+breve+introducci%C3%B3n+a+StrutsTestCase">Una breve introducci&oacute;n a StrutsTestCase</a>
</li>
<li>
<a href="#API+de+StrutsTestCase">API de StrutsTestCase</a>
</li>
</ul>
</li>
</ul>
</div>

<a name="N1000C"></a><a name="Internacionalizaci%C3%B3n"></a>
<h2 class="underlined_10">Internacionalizaci&oacute;n</h2>
<div class="section">
<p>En una red sin fronteras, desarrollar una aplicaci&oacute;n web multilenguaje es una necesidad, no una opci&oacute;n. Reconociendo
esta necesidad, la plataforma Java proporciona una serie de facilidades para desarrollar aplicaciones que "hablen" el
 idioma propio del usuario. Struts se basa en ellas y a&ntilde;ade algunas propias con el objeto de hacer lo m&aacute;s sencillo posible el proceso
 de desarrollo.</p>
<div class="frame note">
<div class="label">Nota</div>
<div class="content">La <strong>Internacionalizaci&oacute;n</strong> es el proceso de dise&ntilde;o y desarrollo que lleva a que una aplicaci&oacute;n pueda
ser adaptada f&aacute;cilmente a diversos idiomas y regiones sin necesidad de cambios en el c&oacute;digo. Algunas veces
el nombre se abrevia a <em>i18n</em>  porque en la palabra hay 18 letras entre la primera "i" y
la &uacute;ltima "n".La <strong>Localizaci&oacute;n</strong> es el proceso de adaptar un software a un idioma y regi&oacute;n concretos. Este
proceso se abrevia a veces como <em>l10n</em> (por motivos que ahora mismo deber&iacute;an ser obvios...).
</div>
</div>
<p>Aunque el cambio del idioma es la parte generalmente m&aacute;s costosa a la hora de localizar una aplicaci&oacute;n, no es el &uacute;nico
factor. Pa&iacute;ses o regiones diferentes tienen, adem&aacute;s de idiomas diferentes, distintas monedas, formas de especificar 
fechas o de escribir n&uacute;meros con decimales.</p>
<a name="N10027"></a><a name="El+soporte+de+internacionalizaci%C3%B3n+de+Java"></a>
<h3 class="underlined_5">El soporte de internacionalizaci&oacute;n de Java</h3>
<p>Como ya hemos comentado, la propia plataforma Java ofrece soporte a la internacionalizaci&oacute;n, sobre el que se basa el
que ofrece Struts. Este soporte se fundamenta en tres clases b&aacute;sicas: <span class="codefrag">java.util.Locale</span>, 
<span class="codefrag">java.util.ResourceBundle</span>
y <span class="codefrag">java.text.MessageFormat</span>
</p>
<a name="N10038"></a><a name="Locale"></a>
<h4>Locale</h4>
<p>Es el n&uacute;cleo fundamental de todo el soporte de internacionalizaci&oacute;n de Java. Un <em>locale</em> es una
combinaci&oacute;n de idioma y pa&iacute;s (y opcionalmente, aunque muchas veces no se usa, una variante o dialecto). Tanto el pa&iacute;s
como el idioma se especifican con c&oacute;digos ISO (est&aacute;ndares ISO-3166 e ISO-639). Por ejemplo, el siguiente
c&oacute;digo crear&iacute;a un <em>locale</em> para espa&ntilde;ol de Argentina</p>
<pre class="code">
Locale vos = new Locale("es","AR");
</pre>
<p>Algunos m&eacute;todos de la librer&iacute;a est&aacute;ndar son "sensibles" al idioma
y aceptan un <em>locale</em> como par&aacute;metro para formatear alg&uacute;n dato, por ejemplo</p>
<pre class="code">
NumberFormat nf = java.text.NumberFormat.getCurrencyInstance(new Locale("es","ES"));
//Esto imprimir&aacute; "100,00 &euro;"
System.out.println(nf.format(100));
</pre>
<p>De una forma similar, Struts tiene tambi&eacute;n clases y etiquetas "sensibles" al <em>locale</em> actual de la aplicaci&oacute;n.
Posteriormente veremos c&oacute;mo hacer en Struts para cambiar el <em>locale</em>.</p>
<a name="N1005F"></a><a name="ResourceBundle"></a>
<h4>ResourceBundle</h4>
<p>Esta clase sirve para almacenar de manera independiente del c&oacute;digo los mensajes de texto
que necesitaremos traducir para poder internacionalizar la aplicaci&oacute;n. De este modo no se necesita recompilar
el c&oacute;digo fuente para cambiar o adaptar el texto de los mensajes.</p>
<p>Un <em>resource bundle</em> es una colecci&oacute;n de objetos de la clase <span class="codefrag">Properties</span>. Cada 
<span class="codefrag">Properties</span> est&aacute; asociado a un determinado <span class="codefrag">Locale</span>, y almacena los textos
correspondientes a un idioma y regi&oacute;n concretos.</p>
<p>
<span class="codefrag">ResourceBundle</span> es una clase abstracta con dos implementaciones en la librer&iacute;a est&aacute;ndar, 
<span class="codefrag">ListResourceBundle</span> y <span class="codefrag">PropertyResourceBundle</span>. Esta &uacute;ltima es la que se usa
en Struts, y almacena los mensajes en ficheros de texto del tipo <span class="codefrag">.properties</span>. Este fichero
es de texto plano y puede crearse con cualquier editor. Por convenci&oacute;n, el 
nombre del <em>locale</em> asociado a cada fichero se coloca al final del nombre del fichero, 
antes de la extensi&oacute;n. Recordemos de la sesi&oacute;n 1 que en Struts se emplea una etiqueta en el fichero de configuraci&oacute;n
para indicar d&oacute;nde est&aacute;n los mensajes de la aplicaci&oacute;n:</p>
<pre class="code">
 &lt;message-resources parameter="mensajes"/&gt;
</pre>
<p>Si internacionalizamos la aplicaci&oacute;n, los mensajes correspondientes a los distintos idiomas y regiones se podr&iacute;an
almacenar en ficheros como los siguientes:</p>
<pre class="code">
mensajes_es_ES.properties
mensajes_es_AR.properties
mensajes_en_UK.properties
</pre>
<p>As&iacute;, el fichero <span class="codefrag">mensajes_es_ES.properties</span>, con los mensajes en idioma espa&ntilde;ol (es) para Espa&ntilde;a (ES),
podr&iacute;a contener algo como lo siguiente:</p>
<pre class="code">
saludo = Hola
error= lo sentimos, se ha producido un error
</pre>
<p>No es necesario especificar tanto el idioma como el pa&iacute;s, se puede especificar solo el idioma (por ejemplo
<span class="codefrag">mensajes_es.properties</span>). Si se tiene esto y el locale actual es del mismo idioma y otro pa&iacute;s, el
sistema tomar&aacute; el fichero con el idioma apropiado. Si no existe ni siquiera fichero con el idioma apropiado,entonces
acudir&aacute; al fichero por defecto, que en nuestro caso ser&iacute;a <span class="codefrag">mensajes.properties</span>.</p>
<a name="N100A7"></a><a name="MessageFormat"></a>
<h4>MessageFormat</h4>
<p>Los mensajes totalmente gen&eacute;ricos no son muy ilustrativos para el usuario: por ejemplo el mensaje
"ha habido un error en el formulario" es mucho menos intuitivo que "ha habido un error con el campo login del formulario".
Por ello, Java ofrece soporte para crear mensajes con par&aacute;metros, a trav&eacute;s de la clase <span class="codefrag">MessageFormat</span>. En estos
mensajes los par&aacute;metros se indican con n&uacute;meros entre llaves. As&iacute;, un mensaje como </p>
<pre class="code">
Se ha producido un error con el campo {0} del formulario
</pre>
<p>Se puede rellenar en tiempo de ejecuci&oacute;n, sustituyendo el <strong>{0}</strong> por el valor deseado. Aunque
la asignaci&oacute;n de los valores a los par&aacute;metros se puede hacer con el API est&aacute;ndar de Java, lo habitual
en una aplicaci&oacute;n de Struts es que el framework lo haga por nosotros (recordemos que es lo que ocurr&iacute;a con los
mensajes de error gestionados a trav&eacute;s de la clase<span class="codefrag">ActionMessage</span>).</p>
<p>Adem&aacute;s de Strings, se pueden formatear fechas, horas y n&uacute;meros. Para ello hay que especificar, separado por
comas, el tipo de par&aacute;metro: fecha (<span class="codefrag">date</span>), hora (<span class="codefrag">time</span>) o n&uacute;mero (<span class="codefrag">number</span>) y luego el estilo 
(<span class="codefrag">short</span>, <span class="codefrag">medium</span>, <span class="codefrag">long</span>, <span class="codefrag">full</span> para fechas  e <span class="codefrag">integer</span>,<span class="codefrag">currency</span> o <span class="codefrag">percent</span> para n&uacute;meros).
Por ejemplo:</p>
<pre class="code">
Se ha realizado un cargo de {0,number,currency} a su cuenta con fecha {1,date,long}
</pre>
<a name="N100E7"></a><a name="El+soporte+de+internacionalizaci%C3%B3n+de+Struts"></a>
<h3 class="underlined_5">El soporte de internacionalizaci&oacute;n de Struts</h3>
<p>Vamos a ver en los siguientes apartados c&oacute;mo internacionalizar una aplicaci&oacute;n Struts.
El <em>framework</em> pone en marcha por defecto el soporte de internacionalizaci&oacute;n, aunque
podemos desactivarlo pas&aacute;ndole al servlet controlador el par&aacute;metro <span class="codefrag">locale</span> con valor
<span class="codefrag">false</span> (se pasar&iacute;a con la etiqueta <span class="codefrag">&lt;init-param&gt;</span> en el <span class="codefrag">web.xml</span>).</p>
<a name="N100FF"></a><a name="Cambiar+el+locale+actual"></a>
<h4>Cambiar el locale actual</h4>
<p>Struts almacena el <em>locale</em> actual en la sesi&oacute;n HTTP como un atributo cuyo nombre
es el valor de la constante <span class="codefrag">Globals.LOCALE_KEY</span>. As&iacute;, para obtener el <em>locale</em>
 en una acci&oacute;n podr&iacute;amos hacer:</p>
<pre class="code">
Locale locale = request.getSession().getAttribute(Globals.LOCALE_KEY);
</pre>
<p>Al locale inicialmente se le da el valor del que tiene por defecto del servidor. El locale del usuario
que est&aacute; "al otro lado" navegando se puede obtener con la llamada al m&eacute;todo <span class="codefrag">getLocale()</span> del
objeto <span class="codefrag">HttpServletRequest</span>. La informaci&oacute;n sobre el locale del usuario se obtiene a trav&eacute;s
de las cabeceras HTTP que env&iacute;a su navegador.</p>
<div class="frame note">
<div class="label">Nota</div>
<div class="content">Los navegadores generalmente ofrecen la posibilidad al usuario
de cambiar el idioma preferente para visualizar las p&aacute;ginas. Esto lo que hace es cambiar la cabecera HTTP
<span class="codefrag">Accept-Language</span> que env&iacute;a el navegador, y como hemos visto, puede utilizarse desde nuestra aplicaci&oacute;n de Struts
para darle un valor al locale.</div>
</div>
<p>Los <em>locales</em> son objetos inmutables, por lo que para cambiar el actual por otro, hay que crear
uno nuevo:</p>
<pre class="code">
Locale nuevo = new Locale("es","ES");
Locale locale = request.getSession().setAttribute(Globals.LOCALE_KEY,nuevo);
</pre>
<p>A partir de este momento, los componentes de Struts "sensibles" al locale mostrar&aacute;n la informaci&oacute;n
teniendo en cuenta el nuevo locale.</p>
<a name="N10132"></a><a name="MessageResources%3A+el+ResourceBundle+de+Struts"></a>
<h4>MessageResources: el ResourceBundle de Struts</h4>
<p>En Struts, la clase <span class="codefrag">MessageResources</span> es la que sirve para gestionar los ficheros con los
mensajes localizados. Se basa en la clase est&aacute;ndar <span class="codefrag">PropertyResourceBundle</span>, por lo que los
mensajes se almacenan en ficheros <span class="codefrag">.properties</span>. Recordemos de la sesi&oacute;n 1 que para indicar cu&aacute;l es
el fichero con los mensajes de la aplicaci&oacute;n se usa la etiqueta <span class="codefrag">&lt;message-resources&gt;</span> en el fichero 
<span class="codefrag">struts-config.xml</span>. Ahora ya sabemos que podemos tener varios ficheros .properties, cada uno para
un <em>locale</em> distinto.</p>
<p>Aunque lo m&aacute;s habitual es mostrar los mensajes localizados a trav&eacute;s de las etiquetas de las <em>taglibs</em>
de Struts, tambi&eacute;n podemos acceder a los mensajes directamente con el API de <span class="codefrag">MessageResources</span>. Por ejemplo,
en una acci&oacute;n podemos hacer lo siguiente:</p>
<pre class="code">
Locale locale = request.getSession().getAttribute(Globals.LOCALE_KEY);
MessageResources mens = getResources(request);
String m = mens.getMessage(locale, "error");
</pre>
<a name="N1015B"></a><a name="Componentes+de+Struts+%22sensibles%22+al+locale"></a>
<h4>Componentes de Struts "sensibles" al locale</h4>
<p>Ya vimos en la primera sesi&oacute;n c&oacute;mo se gestionaban los errores en las acciones a trav&eacute;s de las clases
<span class="codefrag">ActionMessage</span> y <span class="codefrag">ActionErrors</span>. Estas clases est&aacute;n internacionalizadas, de modo que
si tenemos adecuadamente definidos los <span class="codefrag">.properties</span>, los mensajes de error estar&aacute;n localizados
sin necesidad de esfuerzo adicional por nuestra parte.</p>
<p>Varias etiquetas de las <em>taglibs</em> de Struts est&aacute;n internacionalizadas. La m&aacute;s t&iacute;pica es
<span class="codefrag">&lt;bean:message&gt;</span>, que se emplea para imprimir mensajes localizados. La mayor parte de etiquetas
para mostrar campos de formulario tambi&eacute;n est&aacute;n internacionalizadas (por ejemplo <span class="codefrag">&lt;html:option&gt;</span>). </p>
<p>Por ejemplo, para escribir en un JSP un mensaje localizado podemos hacer:</p>
<pre class="code">
&lt;bean:message key="saludo"&gt; 
</pre>
<p>Donde el par&aacute;metro <span class="codefrag">key</span> es la clave que tiene el mensaje en el <span class="codefrag">.properties</span>
del <em>locale</em> actual. Si el mensaje tiene par&aacute;metros, se les puede dar valor con los atributos <span class="codefrag">arg0</span> a
<span class="codefrag">arg4</span>, por ejemplo:</p>
<pre class="code">
&lt;bean:message key="saludo" arg0="${usuarioActual.login}"&gt; 
</pre>
<p>Aunque no es muy habitual, se puede tambi&eacute;n especificar el <em>locale</em> en la
propia etiqueta, mediante el par&aacute;metro del mismo nombre o el <em>resource bundle</em> a usar, mediante el
par&aacute;metro <span class="codefrag">bundle</span>. En estos dos &uacute;ltimos casos, los valores de los par&aacute;metros son los nombres de beans
de sesi&oacute;n que contienen el <em>locale</em> o el <em>resource bundle</em>, respectivamente.</p>
<a name="N101A9"></a><a name="Localizaci%C3%B3n+de+%22validator%22"></a>
<h4>Localizaci&oacute;n de "validator"</h4>
<p>Los mensajes que muestra el <em>plugin</em> validator utilizan el <span class="codefrag">MessageResources</span>, por lo que ya
aparecer&aacute;n localizados autom&aacute;ticamente. No obstante, puede haber algunos elementos cuyo formato deba cambiar
con el <em>locale</em>, como podr&iacute;a ser un n&uacute;mero de tel&eacute;fono, un c&oacute;digo postal, etc. Por ello, en validator
se puede asociar una validaci&oacute;n con un determinado <em>locale</em>. Recordemos que en validator se usaba
la etiqueta <span class="codefrag">&lt;form&gt;</span> para definir la validaci&oacute;n a realizar sobre un ActionForm.</p>
<pre class="code">
&lt;form name="registro" <strong>locale="es" country="ES"</strong>&gt;
  &lt;field property="codigoPostal" depends="required,mask"&gt;
  	&lt;var&gt;
  		&lt;var-name&gt;mask&lt;/var-name&gt;
  		&lt;var-value&gt;^[0-9]{5}$&lt;/var-value&gt;  	
  	&lt;/var&gt;
  &lt;/field&gt;
&lt;/form&gt;
&lt;!-- en Argentina, los C.P. tienen 1 letra seguida de 4 d&iacute;gitos y luego 3 letras m&aacute;s --&gt;
&lt;form name="registro" <strong>locale="es" country="AR"</strong>&gt;
  &lt;field property="codigoPostal" depends="required,mask"&gt;
  	&lt;var&gt;
  		&lt;var-name&gt;mask&lt;/var-name&gt;
  		&lt;var-value&gt;^[A-Z][0-9]{4}[A-Z]{3}$&lt;/var-value&gt;  	
  	&lt;/var&gt;
  &lt;/field&gt;
&lt;/form&gt;
</pre>
<p>Como vemos, los par&aacute;metros <span class="codefrag">locale</span> y <span class="codefrag">country</span> de la etiqueta nos permiten
especificar el idioma y el pa&iacute;s, respectivamente. No son los dos obligatorios, podemos especificar solo el <span class="codefrag">locale</span>.
Adem&aacute;s, estos atributos tambi&eacute;n los admite la etiqueta <span class="codefrag">&lt;formset&gt;</span>, de modo que podr&iacute;amos
crear un conjunto de <span class="codefrag">forms</span> distinto para cada locale.</p>
</div>
 
<a name="N101E0"></a><a name="Pruebas"></a>
<h2 class="underlined_10">Pruebas</h2>
<div class="section">
<p>Ya hab&eacute;is visto a lo largo del curso la importancia de las pruebas en cualquier metodolog&iacute;a
 moderna de desarrollo de software. Aunque en principio una aplicaci&oacute;n Struts se podr&iacute;a probar con Cactus, que es
 una capa sobre JUnit que permite probar aplicaciones web, aqu&iacute; usaremos<em>StrutsTestCase</em> (<a class="external" href="http://strutstestcase.sourceforge.net/">http://strutstestcase.sourceforge.net/</a>)
 que es una extensi&oacute;n de <em>JUnit</em> que permite probar las acciones de manera individual, comprobando los resultados, 
 los ActionErrors generados, etc. <em>StrutsTestCase</em> permite utilizar tanto el enfoque 
 basado en objetos Mock (si nuestro caso hereda de <span class="codefrag">MockStrutsTestCase</span>) como el 
 basado en <em>Cactus</em> (usando <span class="codefrag">CactusStrutsTestCase</span>), lo que permite 
 probar el c&oacute;digo fuera o dentro del contenedor web, respectivamente.</p>
<p>Al utilizar el controlador <span class="codefrag">ActionServlet</span> para probar el c&oacute;digo, este framework permite probar tanto la implementaci&oacute;n de los objetos Action, como los mappings, beans de formulario y declaraciones <em>forward</em>.</p>
<a name="N10208"></a><a name="Una+breve+introducci%C3%B3n+a+StrutsTestCase"></a>
<h3 class="underlined_5">Una breve introducci&oacute;n a StrutsTestCase</h3>
<p>Para mostrar como podemos probar un Action, vamos a realizar la prueba de la entrada de un usuario a una aplicaci&oacute;n.</p>
<p>En el siguiente trozo de c&oacute;digo tenemos el esqueleto b&aacute;sico de una prueba StrutsTestCase basada en <em>Cactus</em>, donde heredamos de la indicada y en el cuerpo del m&eacute;todo configuramos cual es el Action que deseamos probar (el cual debe existir en el archivo <span class="codefrag">struts-config.xml</span>). A continuaci&oacute;n, realizamos la llamada al Action para su ejecuci&oacute;n.</p>
<pre class="code">
import servletunit.struts.CactusStrutsTestCase;

public class <strong>LoginActionTest extends CactusStrutsTestCase</strong> {

    public void testLogin() {
        <strong>setRequestPathInfo("/login");</strong>
        
        <strong>actionPerform();</strong>
    }

}
</pre>
<p>Normalmente, sobre un mismo <em>Action</em> se realiza m&aacute;s de una prueba, para comprobar su funcionamiento cuando las cosas no van bien.</p>
<pre class="code">
public class LoginActionTest extends CactusStrutsTestCase {

    public LoginActionTest(String testName) {
        super(testName);
    }
    
    @Override
    protected void setUp() throws Exception {
        super.setUp();

        // Configuracion del ActionMapping. Lo ponemos aqui
        // pq es comun a todos los casos de prueba de esta clase
        setRequestPathInfo("/login");
    }

    public void testLogin() {
        
        // Configuramos el formulario
        LoginForm unForm = new LoginForm();
        unForm.setLogin("j2ee");
        unForm.setPassword("j2ee");
        <strong>setActionForm</strong>(unForm);
        
        // Llamada al Action
        <strong>actionPerform();</strong>
        
        // Comprobamos que redirige al ActionForward correcto
        <strong>verifyForward</strong>(Tokens.SUCCESS);
        
        // Comprobamos que no han habido errores
        <strong>verifyNoActionErrors();</strong>
    }
    
    public void testLoginKO() {
        
        // Configuramos el formulario
        LoginForm unForm = new LoginForm();
        unForm.setLogin("fdsagdsa");
        unForm.setPassword("gdsahaas");
        setActionForm(unForm);
        
        // Llamada al Action
        actionPerform();
        
        // Comprobamos que redirige al InputForward
        <strong>verifyInputForward</strong>();
        
        // Comprobamos que hay errores
        <strong>verifyActionErrors</strong>(new String[] {Tokens.ERROR_KEY_LOGIN_KO});
    }
}
</pre>
<p>Del c&oacute;digo podemos observar como toda prueba tiene 4 partes claramente diferenciadas:</p>
<ol>

<li>Configuraci&oacute;n del <em>Action</em> a probar. Opcionalmente debemos configurar la ruta del archivo <span class="codefrag">struts-config.xml</span> (si no se encuentra en el classpath)</li>

<li>Preparaci&oacute;n de los datos de entrada al <em>Action</em>, ya sea mediante:
    <ul>
        
<li>la creaci&oacute;n de un objeto <em>ActionForm</em> y posterior inclusi&oacute;n en la prueba</li>
        
<li>o inclusi&oacute;n de par&aacute;metros en el objeto <em>Request</em> (mediante el m&eacute;todo <span class="codefrag">addRequestParameter(String nombreParametro, String valorParametro)</span>)</li>
    
</ul>

</li>

<li>Llamada a la ejecuci&oacute;n del <em>Action</em>.</li>

<li>Validaci&oacute;n final de los datos de salida, forwards y/o mensajes de error.</li>

</ol>
<a name="N10274"></a><a name="API+de+StrutsTestCase"></a>
<h3 class="underlined_5">API de StrutsTestCase</h3>
<p>Este framework extiende JUnit y ofrece m&uacute;ltitud de m&eacute;todos que permiten acceder a todos los recursos de Struts. El API del framework est&aacute; bastante bien documentada, pero a modo de resumen, vamos a exponer cuales son los m&eacute;todos m&aacute;s utilizados.</p>
<table class="ForrestTable" cellspacing="1" cellpadding="4">
        
<tr>
<th colspan="1" rowspan="1">M&eacute;todo</th><th colspan="1" rowspan="1">Explicaci&oacute;n</th>
</tr>
        
<tr>
            
<td colspan="1" rowspan="1"><span class="codefrag">setRequestPathInfo(String pathInfo)</span></td>
            <td colspan="1" rowspan="1">Indica el ActionMapping a probar</td>
        
</tr>
        
<tr>
            
<td colspan="1" rowspan="1"><span class="codefrag">setConfigFile(String configFile)</span></td>
            <td colspan="1" rowspan="1">Ruta del archivo <span class="codefrag">struts-config.xml</span></td>
        
</tr>
        
<tr>
            
<td colspan="1" rowspan="1"><span class="codefrag">actionPerform()</span></td>
            <td colspan="1" rowspan="1">Pasa el control al <em>Action</em> a probar</td>
        
</tr>
        
<tr>
            
<td colspan="1" rowspan="1"><span class="codefrag">verifyForward(String forward)</span></td>
            <td colspan="1" rowspan="1">Comprueba si el controlador ha utilizado este forward</td>
        
</tr>
        
<tr>
            
<td colspan="1" rowspan="1"><span class="codefrag">verifyInputForward()</span></td>
            <td colspan="1" rowspan="1">Comprueba que el controlador ha redirigido al forward de entrada definido</td>
        
</tr>
        
<tr>
            
<td colspan="1" rowspan="1"><span class="codefrag">verifyNoActionErrors()</span></td>
            <td colspan="1" rowspan="1">Comprueba que el controlador no ha enviado mensajes de error tras ejecutar el <em>Action</em></td>
        
</tr>
        
<tr>
            
<td colspan="1" rowspan="1"><span class="codefrag">verifyActionErrors(String[] nombresError)</span></td>
            <td colspan="1" rowspan="1">Comprueba que el controlador ha enviado estos mensajes de error</td>
        
</tr>
    
</table>
</div>

 
<p class="pageBreakAfter"></p>
 
 
</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2008-2009 Depto. CCIA</div>
</div>
</body>
</html>
