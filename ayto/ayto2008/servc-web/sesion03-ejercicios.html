<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Ejercicios de Servicios Web Avanzados</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://www.jtech.ua.es/j2ee"><img class="logoImage" alt="jtech" src="images/baner_j2ee_izq.gif" title="Especialista Universitario Java Enterprise"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="Servicios Web" src="images/baner_j2ee_der.gif" title="Servicios Web"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="javascript:location.href='../index.html'">Home</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../aplic-web.html'">Aplicaciones Web</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../aplic-ent.html'">Aplicaciones Enterprise</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../charlas.html'">Charlas</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../proy-int/index.html'">Proyecto</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Servicios Web</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Servicios Web</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Servicios Web">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_1.1.2', 'skin/')" id="menu_1.1.2Title" class="menutitle">Teor&iacute;a</div>
<div id="menu_1.1.2" class="menuitemgroup">
<div class="menuitem">
<a href="sesion01-apuntes.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-apuntes.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-apuntes.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-apuntes.html">Sesion 4</a>
</div>
<div class="menuitem">
<a href="roadmap-apuntes.html" title="Roadmap">Roadmap</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.3', 'skin/')" id="menu_selected_1.1.3Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Ejercicios</div>
<div id="menu_selected_1.1.3" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="sesion01-ejercicios.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-ejercicios.html">Sesion 2</a>
</div>
<div class="menupage">
<div class="menupagetitle">Sesion 3</div>
</div>
<div class="menuitem">
<a href="sesion04-ejercicios.html">Sesion 4</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion03-ejercicios.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Ejercicios de Servicios Web Avanzados</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Optimizaci%C3%B3n+de+datos+binarios">Optimizaci&oacute;n de datos binarios</a>
</li>
<li>
<a href="#Env%C3%ADo+fiable+de+mensajes+%28*%29">Env&iacute;o fiable de mensajes (*)</a>
</li>
<li>
<a href="#Carrito+de+la+compra">Carrito de la compra</a>
</li>
<li>
<a href="#Servicio+web+transaccional+%28*%29">Servicio web transaccional (*)</a>
</li>
</ul>
</div>


<p>En la mayor&iacute;a de ejercicios de esta sesi&oacute;n lo que nos interesar&aacute; no es simplemente ver que el servicio 
funciona, sino ver como funciona. Por ejemplo, para estudiar la optimizaci&oacute;n de mensajes, el intercambio
fiable de mensajes, o la seguridad, lo importante ser&aacute; ver qu&eacute; efecto tiene aplicar estas t&eacute;cnicas sobre
los mensajes que se intercambian. Por lo tanto configuraremos el servidor de aplicaciones de forma que vuelque
a la consola el contenido de todos los mensajes transmitidos. Para ello entraremos en la consola de administraci&oacute;n
del servidor (<em>Services &gt; Servers &gt; Grassfish V2 &gt; View Admin Console</em>).</p>


<p>
<img alt="Acceso a la consola de administraci&oacute;n." content-width="6cm" height="351" src="imagenes/sesion3/http_mon_1.gif" width="293"></p>


<p>Una vez dentro de la consola, nos logueamos y vamos a <em>Application Server &gt; JVM Settings &gt; JVM Options</em>,
pulsamos sobre <em>Add JVM Option</em> y en el nuevo hueco creado a&ntilde;adimos la siguiente opci&oacute;n:</p>


<pre class="code">-Dcom.sun.xml.ws.transport.http.HttpAdapter.dump=true</pre>


<p>
<img alt="Activaci&oacute;n de la monitorizaci&oacute;n." content-width="13cm" height="425" src="imagenes/sesion3/http_mon_2.gif" width="645"></p>


<p>Tras esto pulsamos <em>Save</em> para guardar los cambios en las opciones.</p>


<a name="N10035"></a><a name="Optimizaci%C3%B3n+de+datos+binarios"></a>
<h2 class="underlined_10">Optimizaci&oacute;n de datos binarios</h2>
<div class="section">
<p>Vamos a crear un servicio web que devuelva datos binarios, en un proyecto al que llamaremos 
<span class="codefrag">servcweb-sesion03-binario</span>. Definiremos una &uacute;nica operaci&oacute;n que 
devuelva un array de 5 bytes dentro de un servicio llamado <span class="codefrag">BinarioSW</span>:</p>
<pre class="code">public byte [] getData() {
    return new byte[5];
}</pre>
<p>Se pide:</p>
<p>
<em>a)</em> Probar el servicio (con el cliente de prueba) y observar en la consola de Glassfish como se codifica en el mensaje de 
respuesta el contenido devuelto.</p>
<p>
<em>b)</em> Configurar el servicio para que utilice MTOM y volver a probarlo. &iquest;Qu&eacute; diferencia existe
en el mensaje de respuesta con respecto a la ejecuci&oacute;n anterior?</p>
<p>
<em>c)</em> Vamos a a&ntilde;adir una nueva operaci&oacute;n al servicio que devuelva una imagen (<span class="codefrag">Image</span>). 
Comprobar el funcionamiento de esta operaci&oacute;n con y sin activar MTOM. &iquest;Cu&aacute;l es la forma m&aacute;s eficiente de
enviar estos datos?</p>
<div class="frame note">
<div class="label">Ayuda</div>
<div class="content">Podemos crear una nueva imagen vac&iacute;a con <span class="codefrag">new BufferedImage(1024, 768, BufferedImage.TYPE_4BYTE_ABGR)</span>.</div>
</div>
</div>



<a name="N10065"></a><a name="Env%C3%ADo+fiable+de+mensajes+%28*%29"></a>
<h2 class="underlined_10">Env&iacute;o fiable de mensajes (*)</h2>
<div class="section">
<p>Vamos a probar el funcionamiento del env&iacute;o fiable de mensajes. Para ello utilizaremos el servicio web 
del ejercicio anterior (<span class="codefrag">servcweb-sesion03-binario</span>) y crearemos un cliente web para acceder a &eacute;l, 
al que llamaremos <span class="codefrag">servcweb-sesion03-binariocliente</span>. </p>
<p>Se pide:</p>
<p>
<em>a)</em> Desactivar la opci&oacute;n MTOM del servicio. Invocar la operaci&oacute;n <span class="codefrag">getData</span> desde un <em>servlet</em> y observar los mensajes que se intercambian.</p>
<p>
<em>b)</em> Activar la opci&oacute;n de env&iacute;o fiable y observar los mensajes que se intercambian en este
caso.</p>
<p>
<em>c)</em> Vamos a activar las opciones de asegurar la entrega de mensajes en orden y de control de flujo. Observar
la secuencia de mensajes que se produce en este &uacute;ltimo caso al invocar el servicio.</p>
<p>
<em>d)</em> Si esperamos un tiempo desde que se enviaron los primeros mensajes, &iquest;qu&eacute; ocurre? &iquest;C&oacute;mo podemos evitar
que se sigan enviado mensajes despu&eacute;s de haber hecho la llamada?. Introducir el c&oacute;digo necesario en el cliente para
solucionar el problema.</p>
</div>



<a name="N10092"></a><a name="Carrito+de+la+compra"></a>
<h2 class="underlined_10">Carrito de la compra</h2>
<div class="section">
<p>Vamos a crear un servicio web con estado que nos permita mantener un carrito de la compra. Deberemos crear 
un nuevo proyecto web <span class="codefrag">servcweb-sesion03-carrito</span> con los siguiente elementos:</p>
<ul>

<li>
<span class="codefrag">LineaVentaTO</span>: Objeto que encapsular&aacute; los datos de cada art&iacute;culo a&ntilde;adido al carrito:

  <ul>
  
<li>
<em>Nombre del art&iacute;culo</em>
</li>
  
<li>
<em>Cantidad</em>
</li>
  
<li>
<em>Precio unitario</em>
</li>
  
</ul>

</li>


<li>
<span class="codefrag">TiendaSW</span>: Servicio web que nos permitir&aacute; crear un nuevo carrito de la compra. Tendr&aacute; la 
siguiente operaci&oacute;n:

  <ul>
  
<li>
<span class="codefrag">W3CEndpointReference creaCarrito()</span>
</li>
  
</ul>


</li>

<li>
<span class="codefrag">CarritoSW</span>: Servicio web con estado que implementa el carrito de la compra. Mantendr&aacute; una
lista de productos vendidos (<span class="codefrag">LineaVentaTO</span>), y deber&aacute; definir las siguientes operaciones:

  <ul>
  
<li>
<span class="codefrag">void addProducto(String nombre, int cantidad, float precio)</span>
</li>
  
<li>
<span class="codefrag">float getImporteTotal()</span>
</li>
  
<li>
<span class="codefrag">void finalizarCompra()</span>
</li>

</ul>

</li>

</ul>
<p>No es necesario crear ninguna base de datos. La lista de productos se guardar&aacute; en memoria, y al finalizar la
sesi&oacute;n se perder&aacute;.</p>
<p>Una vez implementado el servicio, desarrollar un cliente Java (<span class="codefrag">servcweb-sesion03-carritocliente</span>) 
que lo utilice. Se puede probar con un c&oacute;digo similar al siguiente:</p>
<pre class="code">carrito.addProducto("Tambor 25 DVD grabable", 2, 13.95f);
carrito.addProducto("Pendrive 4GB", 1, 19.95f);
System.out.println("Importe actual: " + carrito.getImporteTotal());
carrito.addProducto("Monitor TFT 19inch", 1, 179.90f);
System.out.println("Importe final: " + carrito.getImporteTotal());
carrito.finalizarCompra();</pre>
</div>


<a name="N100E6"></a><a name="Servicio+web+transaccional+%28*%29"></a>
<h2 class="underlined_10">Servicio web transaccional (*)</h2>
<div class="section">
<p>Vamos a crear un servicio web que soporte transacciones. En las plantillas de la sesi&oacute;n
encontramos un proyecto de nombre <span class="codefrag">servcweb-sesion03-vuelos</span> que contiene
un servicio web que nos permitir&aacute; hacer reservas de vuelos. Se pide:</p>
<p>
<em>a)</em> Cargar el proyecto en Netbeans. Aparecer&aacute; una advertencia, debido a que no 
tendremos configurada la base de datos que necesita el proyecto. Entrando en la pesta&ntilde;a <em>Files</em> veremos
que el proyecto contiene un directorio <span class="codefrag">db</span> con un <em>script</em> SQL para crear
la base de datos, y un <em>buildfile</em> de Ant para ejecutarlo. Comprobamos en el fichero
<span class="codefrag">build.xml</span> que el <em>login</em> y <em>password</em> para acceder a la base de 
datos son correctos, y ejecutamos el objetivo <span class="codefrag">initBD</span> (con el servidor de MySQL
en marcha). Una vez hecho esto, creamos con Netbeans (en la pesta&ntilde;a <em>Services &gt; Databases</em>)
la conexi&oacute;n a la base de datos con URL <span class="codefrag">jdbc:mysql://localhost/vuelos</span>. Con esto
el proyecto deber&aacute; reconocer correctamente la base de datos, y ya no aparecer&aacute; la advertencia.</p>
<p>
<em>b)</em> Desplegamos el proyecto y comprobamos que el servicio funcione correctamente
mediante su cliente de prueba.</p>
<p>
<em>c)</em> Vamos a hacer que la operaci&oacute;n <span class="codefrag">realizaReserva</span> del servicio
soporte transacciones, utilizando el modo <em>Required</em>.</p>
<p>
<em>d)</em> Creamos un cliente web para el servicio. Para ello crearemos un proyecto web
de nombre <span class="codefrag">servcweb-sesion03-vueloscliente</span>, y dentro de &eacute;l un 
<em>servlet</em> desde el cual invocaremos el servicio.</p>
<p>
<em>e)</em> A&ntilde;adimos en el servlet c&oacute;digo para dar de alta a 5 personas en el vuelo 815. 
El c&oacute;digo puede ser similar al siguiente:</p>
<pre class="code">VuelosSW port = service.getVuelosSWPort();
int vuelo = 815;
                
ut.begin();

boolean reservado1 = port.realizaReserva(vuelo, "12345678X", 
                                         "Miguel Lopez");
out.println("&lt;p&gt;Reservado 1 = "+reservado1 + "&lt;/p&gt;");
boolean reservado2 = port.realizaReserva(vuelo, "64332423B", 
                                         "Alberto Zamora");
out.println("&lt;p&gt;Reservado 2 = "+reservado2 + "&lt;/p&gt;");
boolean reservado3 = port.realizaReserva(vuelo, "68372847A", 
                                         "Ana Martinez");
out.println("&lt;p&gt;Reservado 3 = "+reservado3 + "&lt;/p&gt;");
boolean reservado4 = port.realizaReserva(vuelo, "23287877T", 
                                         "Manuel Gomez");
out.println("&lt;p&gt;Reservado 4 = "+reservado4 + "&lt;/p&gt;");
boolean reservado5 = port.realizaReserva(vuelo, "94723535Q", 
                                         "Laura Perez");
out.println("&lt;p&gt;Reservado 5 = "+reservado5 + "&lt;/p&gt;");</pre>
<p>Al ejecutar este servlet veremos que algunos consiguen la reserva, pero otros no. 
Comprobar en la base de datos las reservas que han quedado grabadas.</p>
<p>
<em>f)</em> Este es un grupo de personas que desean viajar juntas,
por lo que si para una de ellas no se consigue reserva tampoco se deber&aacute;n reservar
las dem&aacute;s. Vamos a utilizar transacciones para solucionar este problema. </p>
<p>
<em>g)</em> Recuperar la base de datos original mediante el <em>buildfile</em> 
disponible en el directorio <em>db</em>, y volver a probar a hacer las reservas.
Comprobar que en este caso, si uno de ellos no puede reservarse, tampoco se graben
el resto de reservas.</p>
<p>
<em>h)</em> Cambiar el vuelo al 1623 y volver a probar a hacer la reserva. &iquest;Qu&eacute;
ocurre ahora? Comprobar los datos que han quedado almacenados en la base de datos. 
&iquest;Y si intentamos ejecutar el <em>servlet</em> una segunda vez?</p>
</div>



<p class="pageBreakAfter"></p>


</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2008-2009 Depto. CCIA</div>
</div>
</body>
</html>
