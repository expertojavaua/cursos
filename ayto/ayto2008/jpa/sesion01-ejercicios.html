<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Ejercicios sesi&oacute;n 1: Introducci&oacute;n a JPA</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://www.jtech.ua.es/j2ee"><img class="logoImage" alt="jtech" src="images/baner_j2ee_izq.gif" title="Especialista Universitario Java Enterprise"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="JPA con Hibernate" src="images/baner_j2ee_der.gif" title="JPA con Hibernate"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="javascript:location.href='../index.html'">Home</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../proy-int/index.html'">Proyecto SIGEM</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Persistencia</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">JPA</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="JPA">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_1.1.2', 'skin/')" id="menu_1.1.2Title" class="menutitle">Teor&iacute;a</div>
<div id="menu_1.1.2" class="menuitemgroup">
<div class="menuitem">
<a href="sesion01-apuntes.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-apuntes.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-apuntes.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-apuntes.html">Sesion 4</a>
</div>
<div class="menuitem">
<a href="sesion05-apuntes.html">Sesion 5</a>
</div>
<div class="menuitem">
<a href="sesion06-apuntes.html">Sesion 6</a>
</div>
<div class="menuitem">
<a href="sesion07-apuntes.html">Sesion 7</a>
</div>
<div class="menuitem">
<a href="sesion08-apuntes.html">Sesion 8</a>
</div>
<div class="menuitem">
<a href="roadmap.html">Roadmap JPA</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.3', 'skin/')" id="menu_selected_1.1.3Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Ejercicios</div>
<div id="menu_selected_1.1.3" class="selectedmenuitemgroup" style="display: block;">
<div class="menupage">
<div class="menupagetitle">Sesion 1</div>
</div>
<div class="menuitem">
<a href="sesion02-ejercicios.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-ejercicios.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-ejercicios.html">Sesion 4</a>
</div>
<div class="menuitem">
<a href="sesion05-ejercicios.html">Sesion 5</a>
</div>
<div class="menuitem">
<a href="sesion06-ejercicios.html">Sesion 6</a>
</div>
<div class="menuitem">
<a href="sesion07-ejercicios.html">Sesion 7</a>
</div>
<div class="menuitem">
<a href="sesion08-ejercicios.html">Sesion 8</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion01-ejercicios.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Ejercicios sesi&oacute;n 1: Introducci&oacute;n a JPA</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Puesta+en+marcha+de+la+aplicaci%C3%B3n+de+escritorio">Puesta en marcha de la aplicaci&oacute;n de escritorio HolaMundo</a>
</li>
<li>
<a href="#Puesta+en+marcha+del+servlet">Puesta en marcha del servlet AddMensaje</a>
</li>
<li>
<a href="#Tratando+con+problemas">Tratando con problemas</a>
</li>
</ul>
</div>


<a name="N1000C"></a><a name="Puesta+en+marcha+de+la+aplicaci%C3%B3n+de+escritorio"></a>
<h2 class="underlined_10">Puesta en marcha de la aplicaci&oacute;n de escritorio HolaMundo</h2>
<div class="section">
<p>1. Crea el proyecto <span class="codefrag">jpa-sesion1</span> con la aplicaci&oacute;n <span class="codefrag">HolaMundo</span> vista en la sesi&oacute;n de teor&iacute;a. Necesitar&aacute;s las librer&iacute;as con la implementaci&oacute;n de JPA de Hibernate. Las puedes encontrar en la secci&oacute;n de <a href="http://www.jtech.ua.es/ayto2008/software.html">software</a> de la web del curso.</p>
<p>2. Prueba a ejecutar varias veces la aplicaci&oacute;n, introduciendo varios autores y mensajes. Comprueba con el administrador de MySQL las tablas y los datos creados.</p>
<p>3. Comprueba en la salida est&aacute;ndar las sentencias SQL ejecutadas por Hibernate.</p>
<p>4. Prueba a ejecutar la aplicaci&oacute;n sin cerrar el <span class="codefrag">EntityManager</span>, sin hacer commit de la transacci&oacute;n o sin cerrar el <span class="codefrag">EntityManagerFactory</span>. &iquest;En qu&eacute; casos no se graban los datos en la base de datos?</p>
<p>5. Por &uacute;ltimo, modifica el c&oacute;digo de la aplicaci&oacute;n <span class="codefrag">HolaMundo</span> para que un autor se borre y comprueba que funciona correctamente la anotaci&oacute;n <span class="codefrag">cascade</span>: los mensajes asociados tambi&eacute;n se deber&aacute;n borrar. Para borrar una entidad se debe llamar al m&eacute;todo <span class="codefrag">remove()</span> del entity manager:</p>
<pre class="code">em.remove(autor);</pre>
</div>


<a name="N10041"></a><a name="Puesta+en+marcha+del+servlet"></a>
<h2 class="underlined_10">Puesta en marcha del servlet AddMensaje</h2>
<div class="section">
<p>1. Vamos a crear el proyecto web <span class="codefrag">jpa-sesion1-web</span> con la aplicaci&oacute;n web vista en la sesi&oacute;n de teor&iacute;a. Necesitar&aacute;s las librer&iacute;as JSTL <span class="codefrag">standard.jar</span> y <span class="codefrag">jstl.jar</span>. Las puedes encontrar en la secci&oacute;n de <a href="http://www.jtech.ua.es/ayto2008/software.html">software</a>. Guarda estos JARs en el directorio <span class="codefrag">WEB-INF/ib</span>. Ahora vamos a enlazar (no copiar) en este nuevo proyecto todas las librer&iacute;as de JPA del proyecto anterior. Al enlazar las librer&iacute;as ahorramos mucho espacio (en este y todos los proyectos que vamos a definir en el m&oacute;dulo). El enlace de librer&iacute;as en aplicaciones web no est&aacute; bien resuelto en la versi&oacute;n actual del WTP de Eclipse, pero si sigues las indicaciones que hay a continuaci&oacute;n todo funcionar&aacute; correctmente.</p>
<p>2. En primer lugar, incluye en el build path del proyecto web <span class="codefrag">jpa-sesion1-web</span> todos los JAR del proyecto anterior <span class="codefrag">jpa-sesion1</span>. Debes pinchar en la opci&oacute;n <strong>Add JARs...</strong>, desplegar el directorio <span class="codefrag">jpa-sesion1/lib</span> y seleccionar todos los JARs. Podemos ver el resultado en la siguiente figura:</p>
<p>
<img alt="" content-width="9cm" src="imagenes/librerias-web.png" width="500"></p>
<p>De esta forma hemos incluido las librer&iacute;as en el proyecto web y no tendremos errores de compilaci&oacute;n. Pero todav&iacute;a falta una cosa, con esto no es suficiente. Hay que indicar que esas librer&iacute;as deben desplegarse en el servidor Tomcat cuando se despliegue la aplicaci&oacute;n.</p>
<p>3. Para eso tenemos que pulsar en el bot&oacute;n derecho sobre el proyecto y escoger la opci&oacute;n <strong>Properties</strong> y seleccionar la opci&oacute;n <strong>J2EE Module Dependencies</strong>. En el panel que aparece se deben seleccionar todas las librer&iacute;as para que se desplieguen en el servidor:</p>
<p>
<img alt="" content-width="9cm" src="imagenes/librerias-j2ee.png" width="500"></p>
<p>4. Una vez configuradas las librer&iacute;as, ya s&oacute;lo debes copiar las clases Java, los ficheros JSP y HTML y el fichero <span class="codefrag">etc/META-INF/persistence.xml</span> (recuerda definir este directorio como un directorio de fuentes). A continuaci&oacute;n puedes ver una imagen con el aspecto del proyecto en la perspectiva Java:</p>
<p>
<img alt="" content-width="7cm" src="imagenes/eclipse-web.png" width="326"></p>
<p>5. Despliega el proyecto en el servidor web y carga la p&aacute;gina <strong>http://localhost:8080/jpa-sesion1-web/</strong>. Prueba a dar de alta un autor y un mensaje. La p&aacute;gina JSP debe mostrar un listado de los mensajes del autor introducido, incluyendo el nuevo mensaje.  Al igual en el proyecto anterior, podr&aacute;s ver (esta vez en la salida de la consola) las sentencias SQL que lanza Hibernate a la base de datos. Repite las pruebas varias veces para comprobar que todo funciona correctamente.</p>
</div>


<a name="N10099"></a><a name="Tratando+con+problemas"></a>
<h2 class="underlined_10">Tratando con problemas</h2>
<div class="section">
<p>1. En el proyecto web prueba a cerrar el entity manager justo despu&eacute;s de obtener la colecci&oacute;n de mensajes y <em>antes</em> de hacer el <span class="codefrag">forward()</span>.  El servlet dar&aacute; un error. &iquest;Qu&eacute; tipo de error da? &iquest;Por qu&eacute; piensas que ha dado ese error?</p>
<p>2. Cambia el contenido de la p&aacute;gina JSP y escribe una p&aacute;gina que muestre &uacute;nicamente: "XXXX ha escrito un mensaje" (cambiando XXXX por el nombre del autor que ha escrito el mensaje, claro). Deja el commit y el cierre del entity manager en la misma posici&oacute;n que en el punto anterior. &iquest;Se produce ahora alg&uacute;n error? &iquest;Se escribe correctamente el nombre del autor? &iquest;Qu&eacute; crees que est&aacute; pasando?. Vuelve a dejar la p&aacute;gina como al principio, para que liste los mensajes de un autor.</p>
</div>


<p class="pageBreakAfter"></p>

</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2007-2008 Depto. CCIA</div>
</div>
</body>
</html>
