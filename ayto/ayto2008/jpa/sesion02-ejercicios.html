<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Ejercicios sesi&oacute;n 2: Conceptos b&aacute;sicos de JPA</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://www.jtech.ua.es/j2ee"><img class="logoImage" alt="jtech" src="images/baner_j2ee_izq.gif" title="Especialista Universitario Java Enterprise"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="JPA con Hibernate" src="images/baner_j2ee_der.gif" title="JPA con Hibernate"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="javascript:location.href='../index.html'">Home</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../proy-int/index.html'">Proyecto SIGEM</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Persistencia</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">JPA</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="JPA">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_1.1.2', 'skin/')" id="menu_1.1.2Title" class="menutitle">Teor&iacute;a</div>
<div id="menu_1.1.2" class="menuitemgroup">
<div class="menuitem">
<a href="sesion01-apuntes.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-apuntes.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-apuntes.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-apuntes.html">Sesion 4</a>
</div>
<div class="menuitem">
<a href="sesion05-apuntes.html">Sesion 5</a>
</div>
<div class="menuitem">
<a href="sesion06-apuntes.html">Sesion 6</a>
</div>
<div class="menuitem">
<a href="sesion07-apuntes.html">Sesion 7</a>
</div>
<div class="menuitem">
<a href="sesion08-apuntes.html">Sesion 8</a>
</div>
<div class="menuitem">
<a href="roadmap.html">Roadmap JPA</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.3', 'skin/')" id="menu_selected_1.1.3Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Ejercicios</div>
<div id="menu_selected_1.1.3" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="sesion01-ejercicios.html">Sesion 1</a>
</div>
<div class="menupage">
<div class="menupagetitle">Sesion 2</div>
</div>
<div class="menuitem">
<a href="sesion03-ejercicios.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-ejercicios.html">Sesion 4</a>
</div>
<div class="menuitem">
<a href="sesion05-ejercicios.html">Sesion 5</a>
</div>
<div class="menuitem">
<a href="sesion06-ejercicios.html">Sesion 6</a>
</div>
<div class="menuitem">
<a href="sesion07-ejercicios.html">Sesion 7</a>
</div>
<div class="menuitem">
<a href="sesion08-ejercicios.html">Sesion 8</a>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion02-ejercicios.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Ejercicios sesi&oacute;n 2: Conceptos b&aacute;sicos de JPA</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Servlet">Servlet DoAction</a>
</li>
<li>
<a href="#Construcci%C3%B3n+de+clases">Construcci&oacute;n de clases DAO</a>
</li>
<li>
<a href="#Implementaci%C3%B3n+de+funciones+adicionales">Implementaci&oacute;n de funciones adicionales</a>
</li>
</ul>
</div>



<a name="N1000C"></a><a name="Servlet"></a>
<h2 class="underlined_10">Servlet DoAction</h2>
<div class="section">
<p>Vamos a modificar la aplicaci&oacute;n web para que sea m&aacute;s sencillo a&ntilde;adir nuevas funcionalidades. En la p&aacute;gina HTML vamos a incluir un nuevo campo de texto en el que el usuario escriba la acci&oacute;n que quiere realizar. Tambi&eacute;n vamos que cambiar el servlet para que lea la acci&oacute;n y llame al m&eacute;todo (privado) correspondiente que procesa esa acci&oacute;n.</p>
<p>1. Copia el proyecto <span class="codefrag">jpa-sesion1-web</span> y p&eacute;galo con el nombre <span class="codefrag">jpa-sesion2-web</span>. Aunque esto deber&iacute;a ser suficiente, Eclipse tiene un bug y no configura correctamente el nuevo proyecto. Lo puedes comprobar escogiendo la opci&oacute;n <strong>Add and Remove Projects...</strong> del servidor y comprobando que en la caja de la izquierda aparece el proyecto reci&eacute;n creado con el mismo nombre que ten&iacute;a anteriormente. </p>
<p>2. Para arreglarlo, debes editar el fichero <span class="codefrag">.settings/org.eclipse.wst.common.component</span> y sustituir en &eacute;l el nombre <span class="codefrag">jpa-sesion1-web</span> por <span class="codefrag">jpa-sesion2-web</span>. Debe quedar como sigue:</p>
<pre class="code">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project-modules id="moduleCoreId" project-version="1.5.0"&gt;
   &lt;wb-module deploy-name="jpa-sesion2-web"&gt;
      &lt;wb-resource deploy-path="/" source-path="/WebContent"/&gt;
      &lt;wb-resource deploy-path="/WEB-INF/classes" source-path="/src"/&gt;
      &lt;wb-resource deploy-path="/WEB-INF/classes" source-path="/etc"/&gt;
      &lt;property name="java-output-path" value="build/classes"/&gt;
      &lt;property name="context-root" value="jpa-sesion2-web"/&gt;
   &lt;/wb-module&gt;
&lt;/project-modules&gt;
</pre>
<p>3. Prueba de nuevo a a&ntilde;adir el nuevo proyecto al servidor Tomcat. Ahora ya debe aparecer con el nombre correcto. A&ntilde;ade el proyecto y comprueba que la aplicaci&oacute;n web (ahora en <strong>http://localhost:8080/jpa-sesion2-web/</strong>) funciona correctamente.</p>
<p>4. Cambia el fichero <span class="codefrag">index.html</span>, modificando el nombre del servlet y a&ntilde;adiendo el nuevo par&aacute;metro <span class="codefrag">accion</span> ligado a un nuevo campo de entrada. En ese nuevo campo escribiremos la acci&oacute;n que queremos probar. As&iacute; nos ser&aacute; m&aacute;s sencillo a&ntilde;adir nuevas funcionalidades sin tener que retocar demasiado las p&aacute;ginas HTML de la aplicaci&oacute;n.</p>
<pre class="code">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;
&lt;html&gt;
&lt;head&gt;
   &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;
   &lt;title&gt;Aplicaci&oacute;n web Mensajes&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

   &lt;form action="servlet/DoAction"&gt;
   Mensaje:  &lt;input type="text" name="mensaje"&gt; &lt;br&gt;
   Autor: &lt;input type="text" name="autor"&gt;&lt;br&gt;
   Acci&oacute;n: &lt;input type="text" name="accion"&gt;&lt;br&gt;
   &lt;input type="submit" value="Enviar"&gt;
   &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
<p>5. Renombra el servlet <span class="codefrag">AddMensaje</span> por <span class="codefrag">DoAction</span> y reescr&iacute;belo como sigue:</p>
<pre class="code">package es.ua.jtech.jpa;

import java.io.*;
import java.util.Collection;

import javax.persistence.*;
import javax.servlet.*;
import javax.servlet.http.*;

public class DoAction extends HttpServlet {
   private static final long serialVersionUID = 1L;

   public void doGet(HttpServletRequest request, HttpServletResponse response)
         throws ServletException, IOException {

      String accion = request.getParameter("accion");

      if (accion.equals("add")) {
         doAdd(request, response);
      } else if (accion.equals("lista")) {
         doLista(request, response);
      } else if (accion.equals("cuenta")) {
         doCuenta(request, response);
      } else {
         PrintWriter out = response.getWriter();
         out.println("Error. La acci&oacute;n " + accion + " no est&aacute; implementada");
      }
   }

   private void doCuenta(HttpServletRequest request,
         HttpServletResponse response) throws ServletException, IOException {

	   // Cuenta los mensajes de un autor

   }

   private void doLista(HttpServletRequest request, 
                        HttpServletResponse response)
         throws ServletException, IOException {
      
      // Lista los mensajes de un autor

   }

   private void doAdd(HttpServletRequest request, 
                      HttpServletResponse response)
         throws ServletException, IOException {

      // A&ntilde;ade un mensaje a un autor. Mismo c&oacute;digo que el servlet AddMensaje
   }
}</pre>
<p>6. Cambia por &uacute;ltimo el fichero <span class="codefrag">web.xml</span> para reflejar el nuevo nombre del servlet.</p>
<p>7. Comprueba que todo funciona correctamente con la nueva estructura del servlet. Ahora podremos a&ntilde;adir f&aacute;cilmente nuevas funciones. S&oacute;lo tendremos que a&ntilde;adir un nuevo caso en el <span class="codefrag">switch</span>, el c&oacute;digo de la nueva funci&oacute;n en un m&eacute;todo privado y una nueva p&aacute;gina JSP que haga la presentaci&oacute;n de los resultados.</p>
</div>


<a name="N10060"></a><a name="Construcci%C3%B3n+de+clases"></a>
<h2 class="underlined_10">Construcci&oacute;n de clases DAO</h2>
<div class="section">
<p>Construye las clases <span class="codefrag">AutorDAO</span> y <span class="codefrag">MensajeDAO</span>, siguiendo el esquema visto en la clase de teor&iacute;a. Modifica el m&eacute;todo <span class="codefrag">doAdd()</span> del servlet para que haga las llamadas a estas clases, en lugar de a las entidades.</p>
</div>


<a name="N10075"></a><a name="Implementaci%C3%B3n+de+funciones+adicionales"></a>
<h2 class="underlined_10">Implementaci&oacute;n de funciones adicionales</h2>
<div class="section">
<p>Implementa las acciones que est&aacute;n vac&iacute;as en el servlet (<span class="codefrag">doLista</span> y <span class="codefrag">doCuenta</span>). Implementa las nuevas p&aacute;ginas JSP: </p>
<ul>
	   
<li>
<span class="codefrag">addMensaje.jsp</span>: muestra el nombre del usuario y el texto del mensaje a&ntilde;adido</li>
	   
<li>
<span class="codefrag">cuentaMensajes.jsp</span>: muestra el nombre del usuario y el n&uacute;mero de mensajes que ha a&ntilde;adido</li>
	   
<li>
<span class="codefrag">listaMensajes.jsp</span>: muestra el nombre del usuario y la lista de mensajes que ha a&ntilde;adido (<strong>ya est&aacute; implementada</strong>)</li>
	
</ul>
<p>Y, por &uacute;ltimo, haz que el resultado de cada acci&oacute;n del servlet muestre la p&aacute;gina JSP correspondiente. El m&eacute;todo <span class="codefrag">doAdd()</span> deber&iacute;a redirigir la petici&oacute;n a la p&aacute;gina <span class="codefrag">addMensaje.jsp</span> y lo mismo con el resto de m&eacute;todos.</p>
</div>



<p class="pageBreakAfter"></p>

</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2007-2008 Depto. CCIA</div>
</div>
</body>
</html>
