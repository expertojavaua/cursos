<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.7">
<meta name="Forrest-skin-name" content="pelt">
<title>Ejercicios de JBoss y fuentes de datos</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<div class="header">
<div class="grouplogo">
<a href="http://www.jtech.ua.es/j2ee"><img class="logoImage" alt="jtech" src="images/baner_j2ee_izq.gif" title="Especialista Universitario Java Enterprise"></a>
</div>
<div class="projectlogoA1">
<a href="http://www.dccia.ua.es/"><img class="logoImage" alt="Servidores Web" src="images/baner_j2ee_der.gif" title="Servidores Web"></a>
</div>
<ul id="tabs">
<li>
<a class="base-not-selected" href="javascript:location.href='../index.html'">Home</a>
</li>
<li>
<a class="base-not-selected" href="javascript:location.href='../proy-int/index.html'">Proyecto SIGEM</a>
</li>
<li class="current">
<a class="base-selected" href="index.html">Servidores web</a>
</li>
</ul>
</div>
</div>
<div id="main">
<div id="publishedStrip">
<div id="level2tabs"></div>
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="breadtrail">
             
             &nbsp;
           </div>
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Servidores Web</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html" title="Servidores Web">&Iacute;ndice</a>
</div>
<div onclick="SwitchMenu('menu_1.1.2', 'skin/')" id="menu_1.1.2Title" class="menutitle">Teor&iacute;a</div>
<div id="menu_1.1.2" class="menuitemgroup">
<div class="menuitem">
<a href="sesion01-apuntes.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-apuntes.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-apuntes.html">Sesion 3</a>
</div>
<div class="menuitem">
<a href="sesion04-apuntes.html">Sesion 4</a>
</div>
<div class="menuitem">
<a href="roadmap-apuntes.html">Roadmap</a>
</div>
</div>
<div onclick="SwitchMenu('menu_selected_1.1.3', 'skin/')" id="menu_selected_1.1.3Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">Ejercicios</div>
<div id="menu_selected_1.1.3" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="sesion01-ejercicios.html">Sesion 1</a>
</div>
<div class="menuitem">
<a href="sesion02-ejercicios.html">Sesion 2</a>
</div>
<div class="menuitem">
<a href="sesion03-ejercicios.html">Sesion 3</a>
</div>
<div class="menupage">
<div class="menupagetitle">Sesion 4</div>
</div>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<div id="credit2"></div>
</div>
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="sesion04-ejercicios.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Ejercicios de JBoss y fuentes de datos</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#Despliegue+de+aplicaciones+en+JBoss">Despliegue de aplicaciones en JBoss</a>
<ul class="minitoc">
<li>
<a href="#Desplegar+un+.war+en+JBoss">Desplegar un .war en JBoss</a>
</li>
<li>
<a href="#Ejecutar+JBoss+desde+Eclipse">Ejecutar JBoss desde Eclipse</a>
</li>
</ul>
</li>
<li>
<a href="#Fuentes+de+datos+en+Tomcat">Fuentes de datos en Tomcat</a>
</li>
</ul>
</div>

<a name="N1000C"></a><a name="Despliegue+de+aplicaciones+en+JBoss"></a>
<h2 class="underlined_10">Despliegue de aplicaciones en JBoss</h2>
<div class="section">
<p>Continuando con la aplicaci&oacute;n web <span class="codefrag">comentarios</span> de las sesiones anteriores, vamos a tomar
el proyecto de Eclipse y a desplegarlo en JBoss. Hay dos posibilidades: exportarlo como un .war al servidor
ya arrancado o arrancar el servidor desde Eclipse directamente.</p>
<a name="N10018"></a><a name="Desplegar+un+.war+en+JBoss"></a>
<h3 class="underlined_5">Desplegar un .war en JBoss</h3>
<p>Tenemos que <strong>asegurarnos de que JBoss est&aacute; arrancado</strong> previamente. En Eclipse, exportamos el proyecto como un .war
directamente al directorio <span class="codefrag">server/default/deploy</span> de JBoss. Transcurridos unos segundos aparecer&aacute; un mensaje
como el siguiente, indicando que se ha hecho el despliegue:</p>
<pre class="code">11:39:22,765 INFO  [TomcatDeployer] deploy, ctxPath=/comentarios, warUrl=.../tmp
/deploy/tmp24234Comentarios-exp.war/</pre>
<p>Abrir la URL <span class="codefrag">localhost:8080/comentarios</span> en el navegador para comprobar el despliegue. Insertar un comentario de prueba.</p>
<p>Ahora podemos abrir la consola web de JBoss en <span class="codefrag">http://localhost:8080/web-console</span>. A la izquierda
aparecer&aacute;n las aplicaciones desplegadas en el servidor. Abrimos <span class="codefrag">J2EE Domains &gt; JBoss &gt; jboss.management.local</span>
hasta encontrar <span class="codefrag">comentarios.war</span>. Aqu&iacute; podemos encontrar estad&iacute;sticas de uso/tiempo de la aplicaci&oacute;n. Comprobar el n&uacute;mero
de veces que se ha invocado el servlet (deber&iacute;a ser 1).</p>
<a name="N1003E"></a><a name="Ejecutar+JBoss+desde+Eclipse"></a>
<h3 class="underlined_5">Ejecutar JBoss desde Eclipse</h3>
<p>En este caso <strong>tenemos que tener JBoss parado</strong>, ya que Tomcat lo pondr&aacute; en marcha</p>
<ol>

<li>Crear el servidor en Eclipse: <span class="codefrag">File &gt; New &gt; Other</span>, buscar <span class="codefrag">Server</span> y elegir <span class="codefrag">JBoss 4.2</span>.
Tendremos que decirle a Eclipse d&oacute;nde est&aacute; instalado el servidor. Una vez hecho esto, aceptamos las opciones por defecto</li>

<li>En las propiedades del proyecto, dentro de <span class="codefrag">targeted runtimes</span> deber&iacute;amos marcar tambi&eacute;n JBoss</li>

<li>Al ejecutar el proyecto con <span class="codefrag">Run As</span> nos dar&aacute; a elegir el servidor. Elegir JBoss. A partir de aqu&iacute; todo ser&aacute; equivalente
a lo que antes hac&iacute;amos con Tomcat. Eclipse arrancar&aacute; JBoss, desplegar&aacute; la aplicaci&oacute;n y nos mostrar&aacute; su p&aacute;gina principal.
<div class="frame note">
<div class="label">Nota</div>
<div class="content">
Obs&eacute;rvese que, a diferencia de lo que ocurre con Tomcat, con el que se usa una configuraci&oacute;n "temporal" propia de Eclipse,
en JBoss estamos usando la configuraci&oacute;n original del servidor.
</div>
</div>

</li>

</ol>
</div>

<a name="N1006A"></a><a name="Fuentes+de+datos+en+Tomcat"></a>
<h2 class="underlined_10">Fuentes de datos en Tomcat</h2>
<div class="section">
<p>Para este ejercicio nos volveremos a pasar a Tomcat, ya que es el servidor empleado originalmente en SIGEM. De cualquier
modo, como se ha visto en la sesi&oacute;n, la configuraci&oacute;n en JBoss es similar. Asegurarse de <strong>parar JBoss</strong>
desde Eclipse, ya que funciona en el mismo puerto que Tomcat.</p>
<p>Vamos a cambiar la aplicaci&oacute;n de comentarios para que guarde la informaci&oacute;n en una base de datos. Para ello, seguiremos
estos pasos:</p>
<ol>

<li>Copiar el .jar con el driver de MySQL al directorio <span class="codefrag">lib</span> de Tomcat. El .jar est&aacute; en las plantillas
de la sesi&oacute;n. Si Tomcat estuviera arrancado <strong>tendr&iacute;amos que rearrancarlo</strong> para que tome el driver.</li>

<li>Crear la base de datos: ejecutar el script <span class="codefrag">comentarios.sql</span> en MySQL, para crear la BD con la tabla <span class="codefrag">comentarios</span>. El script
est&aacute; en las plantillas de la sesi&oacute;n.</li>

<li>Crear la fuente de datos en el contexto. En el directorio <span class="codefrag">META-INF</span> debe haber un <span class="codefrag">context.xml</span>
de sesiones anteriores. Editarlo para incluir la configuraci&oacute;n de la fuente de datos:
<pre class="code">

&lt;Context&gt;
   &lt;Resource
        name="comentariosDS"
        type="javax.sql.DataSource"
        auth="Container"
        username="root"
        password="root"
        driverClassName="com.mysql.jdbc.Driver"
        url="jdbc:mysql://localhost:3306/comentarios"
        maxActive="20"
        maxIdle="5"
        maxWait="10000"/&gt;
&lt;/Context&gt;

</pre>

</li>

<li>Cambiar el c&oacute;digo del servlet <span class="codefrag">addComentario</span> y de la p&aacute;gina <span class="codefrag">comentarios.jsp</span>
por los incluidos en las plantillas de la sesi&oacute;n, que hacen uso de la fuente de datos con JDBC. A&ntilde;adir el archivo
<span class="codefrag">FuenteDatos.java</span>, que se encarga del acceso al Datasource propiamente dicho.</li>

<li>Comprobar el correcto funcionamiento de la aplicaci&oacute;n, verificando que almacena la informaci&oacute;n en la tabla.</li>

</ol>
</div>

<p class="pageBreakAfter"></p>

</div>
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("<text>Last Published:</text> " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2007 Depto. CCIA</div>
</div>
</body>
</html>
